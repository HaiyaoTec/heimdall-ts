var Nc=Object.defineProperty;var vc=(H,V,Re)=>V in H?Nc(H,V,{enumerable:!0,configurable:!0,writable:!0,value:Re}):H[V]=Re;var L=(H,V,Re)=>(vc(H,typeof V!="symbol"?V+"":V,Re),Re);(function(H,V){typeof exports=="object"&&typeof module!="undefined"?V(exports):typeof define=="function"&&define.amd?define(["exports"],V):(H=typeof globalThis!="undefined"?globalThis:H||self,V(H.heimdall={}))})(this,function(H){"use strict";var V=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function Re(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach(function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}),e}var ee={},ht={},Ie={},$e={},dt={};Object.defineProperty(dt,"__esModule",{value:!0}),dt.default=void 0;class Ji{constructor(e,r){this._fn=r,this._subscriber=e,this._subscription=null}onComplete(){this._subscriber.onComplete()}onError(e){this._subscriber.onError(e)}onNext(e){try{this._subscriber.onNext(this._fn(e))}catch(r){if(!this._subscription)throw new Error("subscription is null");this._subscription.cancel(),this._subscriber.onError(r)}}onSubscribe(e){this._subscription=e,this._subscriber.onSubscribe(e)}}dt.default=Ji;var Et={};Object.defineProperty(Et,"__esModule",{value:!0}),Et.default=void 0;class Zi{constructor(e,r){this._subscriber=e,this._subscription=null,this._toTake=r}onComplete(){this._subscriber.onComplete()}onError(e){this._subscriber.onError(e)}onNext(e){try{this._subscriber.onNext(e),--this._toTake===0&&this._cancelAndComplete()}catch(r){if(!this._subscription)throw new Error("subscription is null");this._subscription.cancel(),this._subscriber.onError(r)}}onSubscribe(e){this._subscription=e,this._subscriber.onSubscribe(e),this._toTake<=0&&this._cancelAndComplete()}_cancelAndComplete(){if(!this._subscription)throw new Error("subscription is null");this._subscription.cancel(),this._subscriber.onComplete()}}Et.default=Zi;function es(t,e,...r){if(!t){let n;if(e===void 0)n=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let i=0;n=new Error(e.replace(/%s/g,()=>String(r[i++]))),n.name="Invariant Violation"}throw n.framesToPop=1,n}}var ts=es;Object.defineProperty($e,"__esModule",{value:!0}),$e.default=void 0;var rs=Yt(dt),ns=Yt(Et),is=Yt(ts);function Yt(t){return t&&t.__esModule?t:{default:t}}function Nr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class Le{static just(...e){return new Le(r=>{let n=!1,i=0;r.onSubscribe({cancel:()=>{n=!0},request:a=>{for(;!n&&a>0&&i<e.length;)r.onNext(e[i++]),a--;!n&&i==e.length&&r.onComplete()}})})}static error(e){return new Le(r=>{r.onSubscribe({cancel:()=>{},request:()=>{r.onError(e)}})})}static never(){return new Le(e=>{e.onSubscribe({cancel:()=>{},request:()=>{}})})}constructor(e,r=Number.MAX_SAFE_INTEGER){this._max=r,this._source=e}subscribe(e){let r;typeof e=="function"?r=this._wrapCallback(e):r=e;const n=new ss(r,this._max);this._source(n)}lift(e){return new Le(r=>this._source(e(r)))}map(e){return this.lift(r=>new rs.default(r,e))}take(e){return this.lift(r=>new ns.default(r,e))}_wrapCallback(e){const r=this._max;return{onNext:e,onSubscribe(n){n.request(r)}}}}$e.default=Le;class ss{constructor(e,r){Nr(this,"_cancel",()=>{!this._active||(this._active=!1,this._subscription&&this._subscription.cancel())}),Nr(this,"_request",n=>{(0,is.default)(Number.isInteger(n)&&n>=1&&n<=this._max,"Flowable: Expected request value to be an integer with a value greater than 0 and less than or equal to %s, got `%s`.",this._max,n),!!this._active&&(n===this._max?this._pending=this._max:(this._pending+=n,this._pending>=this._max&&(this._pending=this._max)),this._subscription&&this._subscription.request(n))}),this._active=!1,this._max=r,this._pending=0,this._started=!1,this._subscriber=e||{},this._subscription=null}onComplete(){if(!this._active){console.warn("Flowable: Invalid call to onComplete(): %s.",this._started?"onComplete/onError was already called":"onSubscribe has not been called");return}this._active=!1,this._started=!0;try{this._subscriber.onComplete&&this._subscriber.onComplete()}catch(e){this._subscriber.onError&&this._subscriber.onError(e)}}onError(e){if(this._started&&!this._active){console.warn("Flowable: Invalid call to onError(): %s.",this._active?"onComplete/onError was already called":"onSubscribe has not been called");return}this._active=!1,this._started=!0,this._subscriber.onError&&this._subscriber.onError(e)}onNext(e){if(!this._active){console.warn("Flowable: Invalid call to onNext(): %s.",this._active?"onComplete/onError was already called":"onSubscribe has not been called");return}if(this._pending===0){console.warn("Flowable: Invalid call to onNext(), all request()ed values have been published.");return}this._pending!==this._max&&this._pending--;try{this._subscriber.onNext&&this._subscriber.onNext(e)}catch(r){this._subscription&&this._subscription.cancel(),this.onError(r)}}onSubscribe(e){if(this._started){console.warn("Flowable: Invalid call to onSubscribe(): already called.");return}this._active=!0,this._started=!0,this._subscription=e;try{this._subscriber.onSubscribe&&this._subscriber.onSubscribe({cancel:this._cancel,request:this._request})}catch(r){this.onError(r)}}}var _t={};Object.defineProperty(_t,"__esModule",{value:!0}),_t.default=void 0;class we{static of(e){return new we(r=>{r.onSubscribe(),r.onComplete(e)})}static error(e){return new we(r=>{r.onSubscribe(),r.onError(e)})}static never(){return new we(e=>{e.onSubscribe()})}constructor(e){this._source=e}subscribe(e){const r=new os(e);try{this._source(r)}catch(n){r.onError(n)}}flatMap(e){return new we(r=>{let n;const i=()=>{n&&n(),n=null};this._source({onComplete:a=>{e(a).subscribe({onComplete:c=>{r.onComplete(c)},onError:c=>r.onError(c),onSubscribe:c=>{n=c}})},onError:a=>r.onError(a),onSubscribe:a=>{n=a,r.onSubscribe(i)}})})}map(e){return new we(r=>this._source({onComplete:n=>r.onComplete(e(n)),onError:n=>r.onError(n),onSubscribe:n=>r.onSubscribe(n)}))}then(e,r){this.subscribe({onComplete:e||(()=>{}),onError:r||(()=>{})})}}_t.default=we;class os{constructor(e){this._active=!1,this._started=!1,this._subscriber=e||{}}onComplete(e){if(!this._active){console.warn("Single: Invalid call to onComplete(): %s.",this._started?"onComplete/onError was already called":"onSubscribe has not been called");return}this._active=!1,this._started=!0;try{this._subscriber.onComplete&&this._subscriber.onComplete(e)}catch(r){this._subscriber.onError&&this._subscriber.onError(r)}}onError(e){if(this._started&&!this._active){console.warn("Single: Invalid call to onError(): %s.",this._active?"onComplete/onError was already called":"onSubscribe has not been called");return}this._active=!1,this._started=!0,this._subscriber.onError&&this._subscriber.onError(e)}onSubscribe(e){if(this._started){console.warn("Single: Invalid call to onSubscribe(): already called.");return}this._active=!0,this._started=!0;try{this._subscriber.onSubscribe&&this._subscriber.onSubscribe(()=>{!this._active||(this._active=!1,e&&e())})}catch(r){this.onError(r)}}}var pt={};Object.defineProperty(pt,"__esModule",{value:!0}),pt.default=void 0;class as{constructor(e,r){this._source=e,this._transformer=r,this._done=!1,this._mappers=[]}onSubscribe(e){this._subscription=e}onNext(e){if(!this._sink){console.warn("premature onNext for processor, dropping value");return}let r=e;this._transformer&&(r=this._transformer(e));const n=this._mappers.reduce((i,a)=>a(i),r);this._sink.onNext(n)}onError(e){this._error=e,this._sink?this._sink.onError(e):console.warn("premature onError for processor, marking complete/errored")}onComplete(){this._done=!0,this._sink?this._sink.onComplete():console.warn("premature onError for processor, marking complete")}subscribe(e){this._source.subscribe&&this._source.subscribe(this),this._sink=e,this._sink.onSubscribe(this),this._error?this._sink.onError(this._error):this._done&&this._sink.onComplete()}map(e){return this._mappers.push(e),this}request(e){this._subscription&&this._subscription.request(e)}cancel(){this._subscription&&this._subscription.cancel()}}pt.default=as;var qt={};Object.defineProperty(qt,"__esModule",{value:!0}),qt.every=ls;var us=cs($e);function cs(t){return t&&t.__esModule?t:{default:t}}function ls(t){return new us.default(e=>{let r=null,n=0;e.onSubscribe({cancel:()=>{r!=null&&(clearInterval(r),r=null)},request:i=>{i<Number.MAX_SAFE_INTEGER?n+=i:n=Number.MAX_SAFE_INTEGER,r==null&&(r=setInterval(()=>{n>0&&(n!==Number.MAX_SAFE_INTEGER&&n--,e.onNext(Date.now()))},t))}})})}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Flowable",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(t,"Single",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"FlowableProcessor",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"every",{enumerable:!0,get:function(){return i.every}});var e=a($e),r=a(_t),n=a(pt),i=qt;function a(c){return c&&c.__esModule?c:{default:c}}})(Ie);function fs(t,e,...r){if(!t){let n;if(e===void 0)n=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{let i=0;n=new Error(e.replace(/%s/g,()=>String(r[i++]))),n.name="Invariant Violation"}throw n.framesToPop=1,n}}var Oe=fs,g={};Object.defineProperty(g,"__esModule",{value:!0}),g.isIgnore=Ps,g.isMetadata=Ms,g.isComplete=Cs,g.isNext=Ns,g.isRespond=vs,g.isResumeEnable=Fs,g.isLease=Ls,g.isFollows=Us,g.isResumePositionFrameType=xs,g.getFrameTypeName=Fr,g.createErrorFromFrame=Ds,g.getErrorCodeExplanation=jt,g.printFrame=ks,g.MAX_VERSION=g.MAX_TTL=g.MAX_STREAM_ID=g.MAX_RESUME_LENGTH=g.MAX_REQUEST_N=g.MAX_REQUEST_COUNT=g.MAX_MIME_LENGTH=g.MAX_METADATA_LENGTH=g.MAX_LIFETIME=g.MAX_KEEPALIVE=g.MAX_CODE=g.FRAME_TYPE_OFFFSET=g.FLAGS_MASK=g.ERROR_EXPLANATIONS=g.ERROR_CODES=g.FLAGS=g.FRAME_TYPE_NAMES=g.FRAME_TYPES=g.CONNECTION_STREAM_ID=void 0;function vr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function hs(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?vr(Object(r),!0).forEach(function(n){ds(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):vr(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function ds(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const Es=0;g.CONNECTION_STREAM_ID=Es;const te={CANCEL:9,ERROR:11,EXT:63,KEEPALIVE:3,LEASE:2,METADATA_PUSH:12,PAYLOAD:10,REQUEST_CHANNEL:7,REQUEST_FNF:5,REQUEST_N:8,REQUEST_RESPONSE:4,REQUEST_STREAM:6,RESERVED:0,RESUME:13,RESUME_OK:14,SETUP:1};g.FRAME_TYPES=te;const Ht={};g.FRAME_TYPE_NAMES=Ht;for(const t in te){const e=te[t];Ht[e]=t}const D={COMPLETE:64,FOLLOWS:128,IGNORE:512,LEASE:64,METADATA:256,NEXT:32,RESPOND:128,RESUME_ENABLE:128};g.FLAGS=D;const zt={APPLICATION_ERROR:513,CANCELED:515,CONNECTION_CLOSE:258,CONNECTION_ERROR:257,INVALID:516,INVALID_SETUP:1,REJECTED:514,REJECTED_RESUME:4,REJECTED_SETUP:3,RESERVED:0,RESERVED_EXTENSION:4294967295,UNSUPPORTED_SETUP:2};g.ERROR_CODES=zt;const Vt={};g.ERROR_EXPLANATIONS=Vt;for(const t in zt){const e=zt[t];Vt[e]=t}const _s=1023;g.FLAGS_MASK=_s;const ps=10;g.FRAME_TYPE_OFFFSET=ps;const Ss=2147483647;g.MAX_CODE=Ss;const ms=2147483647;g.MAX_KEEPALIVE=ms;const ys=2147483647;g.MAX_LIFETIME=ys;const bs=16777215;g.MAX_METADATA_LENGTH=bs;const As=255;g.MAX_MIME_LENGTH=As;const gs=2147483647;g.MAX_REQUEST_COUNT=gs;const Ts=2147483647;g.MAX_REQUEST_N=Ts;const Rs=65535;g.MAX_RESUME_LENGTH=Rs;const Is=2147483647;g.MAX_STREAM_ID=Is;const ws=2147483647;g.MAX_TTL=ws;const Os=65535;g.MAX_VERSION=Os;function Ps(t){return(t&D.IGNORE)===D.IGNORE}function Ms(t){return(t&D.METADATA)===D.METADATA}function Cs(t){return(t&D.COMPLETE)===D.COMPLETE}function Ns(t){return(t&D.NEXT)===D.NEXT}function vs(t){return(t&D.RESPOND)===D.RESPOND}function Fs(t){return(t&D.RESUME_ENABLE)===D.RESUME_ENABLE}function Ls(t){return(t&D.LEASE)===D.LEASE}function Us(t){return(t&D.FOLLOWS)===D.FOLLOWS}function xs(t){return t===te.CANCEL||t===te.ERROR||t===te.PAYLOAD||t===te.REQUEST_CHANNEL||t===te.REQUEST_FNF||t===te.REQUEST_RESPONSE||t===te.REQUEST_STREAM||t===te.REQUEST_N}function Fr(t){const e=Ht[t];return e!=null?e:Ke(t)}function Bs(t,...e){let r=0;return t.replace(/%s/g,n=>e[r++])}function Ds(t){const{code:e,message:r}=t,n=jt(e),i=new Error(Bs("RSocket error %s (%s): %s. See error `source` property for details.",Ke(e),n,r));return i.source={code:e,explanation:n,message:r},i}function jt(t){const e=Vt[t];return e!=null?e:t<=768?"RESERVED (PROTOCOL)":"RESERVED (APPLICATION)"}function ks(t){const e=hs({},t);e.type=Fr(t.type)+` (${Ke(t.type)})`;const r=[];for(const n in D){const i=D[n];(t.flags&i)===i&&r.push(n)}return r.length||r.push("NO FLAGS"),e.flags=r.join(" | ")+` (${Ke(t.flags)})`,t.type===te.ERROR&&(e.code=jt(t.code)+` (${Ke(t.code)})`),JSON.stringify(e,null,2)}function Ke(t){return"0x"+t.toString(16)}var Ue={};Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.MINOR_VERSION=Ue.MAJOR_VERSION=void 0;const Gs=1;Ue.MAJOR_VERSION=Gs;const Ys=0;Ue.MINOR_VERSION=Ys;var Qe={},K={},se={},Lr={},St={};St.byteLength=zs,St.toByteArray=js,St.fromByteArray=Ks;for(var ae=[],re=[],qs=typeof Uint8Array!="undefined"?Uint8Array:Array,Xt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",xe=0,Hs=Xt.length;xe<Hs;++xe)ae[xe]=Xt[xe],re[Xt.charCodeAt(xe)]=xe;re["-".charCodeAt(0)]=62,re["_".charCodeAt(0)]=63;function Ur(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");r===-1&&(r=e);var n=r===e?0:4-r%4;return[r,n]}function zs(t){var e=Ur(t),r=e[0],n=e[1];return(r+n)*3/4-n}function Vs(t,e,r){return(e+r)*3/4-r}function js(t){var e,r=Ur(t),n=r[0],i=r[1],a=new qs(Vs(t,n,i)),c=0,l=i>0?n-4:n,d;for(d=0;d<l;d+=4)e=re[t.charCodeAt(d)]<<18|re[t.charCodeAt(d+1)]<<12|re[t.charCodeAt(d+2)]<<6|re[t.charCodeAt(d+3)],a[c++]=e>>16&255,a[c++]=e>>8&255,a[c++]=e&255;return i===2&&(e=re[t.charCodeAt(d)]<<2|re[t.charCodeAt(d+1)]>>4,a[c++]=e&255),i===1&&(e=re[t.charCodeAt(d)]<<10|re[t.charCodeAt(d+1)]<<4|re[t.charCodeAt(d+2)]>>2,a[c++]=e>>8&255,a[c++]=e&255),a}function Xs(t){return ae[t>>18&63]+ae[t>>12&63]+ae[t>>6&63]+ae[t&63]}function $s(t,e,r){for(var n,i=[],a=e;a<r;a+=3)n=(t[a]<<16&16711680)+(t[a+1]<<8&65280)+(t[a+2]&255),i.push(Xs(n));return i.join("")}function Ks(t){for(var e,r=t.length,n=r%3,i=[],a=16383,c=0,l=r-n;c<l;c+=a)i.push($s(t,c,c+a>l?l:c+a));return n===1?(e=t[r-1],i.push(ae[e>>2]+ae[e<<4&63]+"==")):n===2&&(e=(t[r-2]<<8)+t[r-1],i.push(ae[e>>10]+ae[e>>4&63]+ae[e<<2&63]+"=")),i.join("")}var $t={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */$t.read=function(t,e,r,n,i){var a,c,l=i*8-n-1,d=(1<<l)-1,S=d>>1,y=-7,A=r?i-1:0,T=r?-1:1,R=t[e+A];for(A+=T,a=R&(1<<-y)-1,R>>=-y,y+=l;y>0;a=a*256+t[e+A],A+=T,y-=8);for(c=a&(1<<-y)-1,a>>=-y,y+=n;y>0;c=c*256+t[e+A],A+=T,y-=8);if(a===0)a=1-S;else{if(a===d)return c?NaN:(R?-1:1)*(1/0);c=c+Math.pow(2,n),a=a-S}return(R?-1:1)*c*Math.pow(2,a-n)},$t.write=function(t,e,r,n,i,a){var c,l,d,S=a*8-i-1,y=(1<<S)-1,A=y>>1,T=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=n?0:a-1,w=n?1:-1,M=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(l=isNaN(e)?1:0,c=y):(c=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-c))<1&&(c--,d*=2),c+A>=1?e+=T/d:e+=T*Math.pow(2,1-A),e*d>=2&&(c++,d/=2),c+A>=y?(l=0,c=y):c+A>=1?(l=(e*d-1)*Math.pow(2,i),c=c+A):(l=e*Math.pow(2,A-1)*Math.pow(2,i),c=0));i>=8;t[r+R]=l&255,R+=w,l/=256,i-=8);for(c=c<<i|l,S+=i;S>0;t[r+R]=c&255,R+=w,c/=256,S-=8);t[r+R-w]|=M*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(t){const e=St,r=$t,n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=C,t.INSPECT_MAX_BYTES=50;const i=2147483647;t.kMaxLength=i,l.TYPED_ARRAY_SUPPORT=a(),!l.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function a(){try{const u=new Uint8Array(1),s={foo:function(){return 42}};return Object.setPrototypeOf(s,Uint8Array.prototype),Object.setPrototypeOf(u,s),u.foo()===42}catch{return!1}}Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(!!l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(!!l.isBuffer(this))return this.byteOffset}});function c(u){if(u>i)throw new RangeError('The value "'+u+'" is invalid for option "size"');const s=new Uint8Array(u);return Object.setPrototypeOf(s,l.prototype),s}function l(u,s,o){if(typeof u=="number"){if(typeof s=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return A(u)}return d(u,s,o)}l.poolSize=8192;function d(u,s,o){if(typeof u=="string")return T(u,s);if(ArrayBuffer.isView(u))return w(u);if(u==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof u);if(fe(u,ArrayBuffer)||u&&fe(u.buffer,ArrayBuffer)||typeof SharedArrayBuffer!="undefined"&&(fe(u,SharedArrayBuffer)||u&&fe(u.buffer,SharedArrayBuffer)))return M(u,s,o);if(typeof u=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const f=u.valueOf&&u.valueOf();if(f!=null&&f!==u)return l.from(f,s,o);const h=Z(u);if(h)return h;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof u[Symbol.toPrimitive]=="function")return l.from(u[Symbol.toPrimitive]("string"),s,o);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof u)}l.from=function(u,s,o){return d(u,s,o)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array);function S(u){if(typeof u!="number")throw new TypeError('"size" argument must be of type number');if(u<0)throw new RangeError('The value "'+u+'" is invalid for option "size"')}function y(u,s,o){return S(u),u<=0?c(u):s!==void 0?typeof o=="string"?c(u).fill(s,o):c(u).fill(s):c(u)}l.alloc=function(u,s,o){return y(u,s,o)};function A(u){return S(u),c(u<0?0:ce(u)|0)}l.allocUnsafe=function(u){return A(u)},l.allocUnsafeSlow=function(u){return A(u)};function T(u,s){if((typeof s!="string"||s==="")&&(s="utf8"),!l.isEncoding(s))throw new TypeError("Unknown encoding: "+s);const o=le(u,s)|0;let f=c(o);const h=f.write(u,s);return h!==o&&(f=f.slice(0,h)),f}function R(u){const s=u.length<0?0:ce(u.length)|0,o=c(s);for(let f=0;f<s;f+=1)o[f]=u[f]&255;return o}function w(u){if(fe(u,Uint8Array)){const s=new Uint8Array(u);return M(s.buffer,s.byteOffset,s.byteLength)}return R(u)}function M(u,s,o){if(s<0||u.byteLength<s)throw new RangeError('"offset" is outside of buffer bounds');if(u.byteLength<s+(o||0))throw new RangeError('"length" is outside of buffer bounds');let f;return s===void 0&&o===void 0?f=new Uint8Array(u):o===void 0?f=new Uint8Array(u,s):f=new Uint8Array(u,s,o),Object.setPrototypeOf(f,l.prototype),f}function Z(u){if(l.isBuffer(u)){const s=ce(u.length)|0,o=c(s);return o.length===0||u.copy(o,0,0,s),o}if(u.length!==void 0)return typeof u.length!="number"||Cr(u.length)?c(0):R(u);if(u.type==="Buffer"&&Array.isArray(u.data))return R(u.data)}function ce(u){if(u>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return u|0}function C(u){return+u!=u&&(u=0),l.alloc(+u)}l.isBuffer=function(s){return s!=null&&s._isBuffer===!0&&s!==l.prototype},l.compare=function(s,o){if(fe(s,Uint8Array)&&(s=l.from(s,s.offset,s.byteLength)),fe(o,Uint8Array)&&(o=l.from(o,o.offset,o.byteLength)),!l.isBuffer(s)||!l.isBuffer(o))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(s===o)return 0;let f=s.length,h=o.length;for(let E=0,_=Math.min(f,h);E<_;++E)if(s[E]!==o[E]){f=s[E],h=o[E];break}return f<h?-1:h<f?1:0},l.isEncoding=function(s){switch(String(s).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(s,o){if(!Array.isArray(s))throw new TypeError('"list" argument must be an Array of Buffers');if(s.length===0)return l.alloc(0);let f;if(o===void 0)for(o=0,f=0;f<s.length;++f)o+=s[f].length;const h=l.allocUnsafe(o);let E=0;for(f=0;f<s.length;++f){let _=s[f];if(fe(_,Uint8Array))E+_.length>h.length?(l.isBuffer(_)||(_=l.from(_)),_.copy(h,E)):Uint8Array.prototype.set.call(h,_,E);else if(l.isBuffer(_))_.copy(h,E);else throw new TypeError('"list" argument must be an Array of Buffers');E+=_.length}return h};function le(u,s){if(l.isBuffer(u))return u.length;if(ArrayBuffer.isView(u)||fe(u,ArrayBuffer))return u.byteLength;if(typeof u!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof u);const o=u.length,f=arguments.length>2&&arguments[2]===!0;if(!f&&o===0)return 0;let h=!1;for(;;)switch(s){case"ascii":case"latin1":case"binary":return o;case"utf8":case"utf-8":return Mr(u).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return o*2;case"hex":return o>>>1;case"base64":return Wi(u).length;default:if(h)return f?-1:Mr(u).length;s=(""+s).toLowerCase(),h=!0}}l.byteLength=le;function ve(u,s,o){let f=!1;if((s===void 0||s<0)&&(s=0),s>this.length||((o===void 0||o>this.length)&&(o=this.length),o<=0)||(o>>>=0,s>>>=0,o<=s))return"";for(u||(u="utf8");;)switch(u){case"hex":return gc(this,s,o);case"utf8":case"utf-8":return qi(this,s,o);case"ascii":return bc(this,s,o);case"latin1":case"binary":return Ac(this,s,o);case"base64":return mc(this,s,o);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Tc(this,s,o);default:if(f)throw new TypeError("Unknown encoding: "+u);u=(u+"").toLowerCase(),f=!0}}l.prototype._isBuffer=!0;function _e(u,s,o){const f=u[s];u[s]=u[o],u[o]=f}l.prototype.swap16=function(){const s=this.length;if(s%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let o=0;o<s;o+=2)_e(this,o,o+1);return this},l.prototype.swap32=function(){const s=this.length;if(s%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let o=0;o<s;o+=4)_e(this,o,o+3),_e(this,o+1,o+2);return this},l.prototype.swap64=function(){const s=this.length;if(s%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let o=0;o<s;o+=8)_e(this,o,o+7),_e(this,o+1,o+6),_e(this,o+2,o+5),_e(this,o+3,o+4);return this},l.prototype.toString=function(){const s=this.length;return s===0?"":arguments.length===0?qi(this,0,s):ve.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(s){if(!l.isBuffer(s))throw new TypeError("Argument must be a Buffer");return this===s?!0:l.compare(this,s)===0},l.prototype.inspect=function(){let s="";const o=t.INSPECT_MAX_BYTES;return s=this.toString("hex",0,o).replace(/(.{2})/g,"$1 ").trim(),this.length>o&&(s+=" ... "),"<Buffer "+s+">"},n&&(l.prototype[n]=l.prototype.inspect),l.prototype.compare=function(s,o,f,h,E){if(fe(s,Uint8Array)&&(s=l.from(s,s.offset,s.byteLength)),!l.isBuffer(s))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof s);if(o===void 0&&(o=0),f===void 0&&(f=s?s.length:0),h===void 0&&(h=0),E===void 0&&(E=this.length),o<0||f>s.length||h<0||E>this.length)throw new RangeError("out of range index");if(h>=E&&o>=f)return 0;if(h>=E)return-1;if(o>=f)return 1;if(o>>>=0,f>>>=0,h>>>=0,E>>>=0,this===s)return 0;let _=E-h,P=f-o;const x=Math.min(_,P),U=this.slice(h,E),B=s.slice(o,f);for(let v=0;v<x;++v)if(U[v]!==B[v]){_=U[v],P=B[v];break}return _<P?-1:P<_?1:0};function ge(u,s,o,f,h){if(u.length===0)return-1;if(typeof o=="string"?(f=o,o=0):o>2147483647?o=2147483647:o<-2147483648&&(o=-2147483648),o=+o,Cr(o)&&(o=h?0:u.length-1),o<0&&(o=u.length+o),o>=u.length){if(h)return-1;o=u.length-1}else if(o<0)if(h)o=0;else return-1;if(typeof s=="string"&&(s=l.from(s,f)),l.isBuffer(s))return s.length===0?-1:Fe(u,s,o,f,h);if(typeof s=="number")return s=s&255,typeof Uint8Array.prototype.indexOf=="function"?h?Uint8Array.prototype.indexOf.call(u,s,o):Uint8Array.prototype.lastIndexOf.call(u,s,o):Fe(u,[s],o,f,h);throw new TypeError("val must be string, number or Buffer")}function Fe(u,s,o,f,h){let E=1,_=u.length,P=s.length;if(f!==void 0&&(f=String(f).toLowerCase(),f==="ucs2"||f==="ucs-2"||f==="utf16le"||f==="utf-16le")){if(u.length<2||s.length<2)return-1;E=2,_/=2,P/=2,o/=2}function x(B,v){return E===1?B[v]:B.readUInt16BE(v*E)}let U;if(h){let B=-1;for(U=o;U<_;U++)if(x(u,U)===x(s,B===-1?0:U-B)){if(B===-1&&(B=U),U-B+1===P)return B*E}else B!==-1&&(U-=U-B),B=-1}else for(o+P>_&&(o=_-P),U=o;U>=0;U--){let B=!0;for(let v=0;v<P;v++)if(x(u,U+v)!==x(s,v)){B=!1;break}if(B)return U}return-1}l.prototype.includes=function(s,o,f){return this.indexOf(s,o,f)!==-1},l.prototype.indexOf=function(s,o,f){return ge(this,s,o,f,!0)},l.prototype.lastIndexOf=function(s,o,f){return ge(this,s,o,f,!1)};function dc(u,s,o,f){o=Number(o)||0;const h=u.length-o;f?(f=Number(f),f>h&&(f=h)):f=h;const E=s.length;f>E/2&&(f=E/2);let _;for(_=0;_<f;++_){const P=parseInt(s.substr(_*2,2),16);if(Cr(P))return _;u[o+_]=P}return _}function Ec(u,s,o,f){return Gt(Mr(s,u.length-o),u,o,f)}function _c(u,s,o,f){return Gt(Oc(s),u,o,f)}function pc(u,s,o,f){return Gt(Wi(s),u,o,f)}function Sc(u,s,o,f){return Gt(Pc(s,u.length-o),u,o,f)}l.prototype.write=function(s,o,f,h){if(o===void 0)h="utf8",f=this.length,o=0;else if(f===void 0&&typeof o=="string")h=o,f=this.length,o=0;else if(isFinite(o))o=o>>>0,isFinite(f)?(f=f>>>0,h===void 0&&(h="utf8")):(h=f,f=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const E=this.length-o;if((f===void 0||f>E)&&(f=E),s.length>0&&(f<0||o<0)||o>this.length)throw new RangeError("Attempt to write outside buffer bounds");h||(h="utf8");let _=!1;for(;;)switch(h){case"hex":return dc(this,s,o,f);case"utf8":case"utf-8":return Ec(this,s,o,f);case"ascii":case"latin1":case"binary":return _c(this,s,o,f);case"base64":return pc(this,s,o,f);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Sc(this,s,o,f);default:if(_)throw new TypeError("Unknown encoding: "+h);h=(""+h).toLowerCase(),_=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function mc(u,s,o){return s===0&&o===u.length?e.fromByteArray(u):e.fromByteArray(u.slice(s,o))}function qi(u,s,o){o=Math.min(u.length,o);const f=[];let h=s;for(;h<o;){const E=u[h];let _=null,P=E>239?4:E>223?3:E>191?2:1;if(h+P<=o){let x,U,B,v;switch(P){case 1:E<128&&(_=E);break;case 2:x=u[h+1],(x&192)===128&&(v=(E&31)<<6|x&63,v>127&&(_=v));break;case 3:x=u[h+1],U=u[h+2],(x&192)===128&&(U&192)===128&&(v=(E&15)<<12|(x&63)<<6|U&63,v>2047&&(v<55296||v>57343)&&(_=v));break;case 4:x=u[h+1],U=u[h+2],B=u[h+3],(x&192)===128&&(U&192)===128&&(B&192)===128&&(v=(E&15)<<18|(x&63)<<12|(U&63)<<6|B&63,v>65535&&v<1114112&&(_=v))}}_===null?(_=65533,P=1):_>65535&&(_-=65536,f.push(_>>>10&1023|55296),_=56320|_&1023),f.push(_),h+=P}return yc(f)}const Hi=4096;function yc(u){const s=u.length;if(s<=Hi)return String.fromCharCode.apply(String,u);let o="",f=0;for(;f<s;)o+=String.fromCharCode.apply(String,u.slice(f,f+=Hi));return o}function bc(u,s,o){let f="";o=Math.min(u.length,o);for(let h=s;h<o;++h)f+=String.fromCharCode(u[h]&127);return f}function Ac(u,s,o){let f="";o=Math.min(u.length,o);for(let h=s;h<o;++h)f+=String.fromCharCode(u[h]);return f}function gc(u,s,o){const f=u.length;(!s||s<0)&&(s=0),(!o||o<0||o>f)&&(o=f);let h="";for(let E=s;E<o;++E)h+=Mc[u[E]];return h}function Tc(u,s,o){const f=u.slice(s,o);let h="";for(let E=0;E<f.length-1;E+=2)h+=String.fromCharCode(f[E]+f[E+1]*256);return h}l.prototype.slice=function(s,o){const f=this.length;s=~~s,o=o===void 0?f:~~o,s<0?(s+=f,s<0&&(s=0)):s>f&&(s=f),o<0?(o+=f,o<0&&(o=0)):o>f&&(o=f),o<s&&(o=s);const h=this.subarray(s,o);return Object.setPrototypeOf(h,l.prototype),h};function G(u,s,o){if(u%1!==0||u<0)throw new RangeError("offset is not uint");if(u+s>o)throw new RangeError("Trying to access beyond buffer length")}l.prototype.readUintLE=l.prototype.readUIntLE=function(s,o,f){s=s>>>0,o=o>>>0,f||G(s,o,this.length);let h=this[s],E=1,_=0;for(;++_<o&&(E*=256);)h+=this[s+_]*E;return h},l.prototype.readUintBE=l.prototype.readUIntBE=function(s,o,f){s=s>>>0,o=o>>>0,f||G(s,o,this.length);let h=this[s+--o],E=1;for(;o>0&&(E*=256);)h+=this[s+--o]*E;return h},l.prototype.readUint8=l.prototype.readUInt8=function(s,o){return s=s>>>0,o||G(s,1,this.length),this[s]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(s,o){return s=s>>>0,o||G(s,2,this.length),this[s]|this[s+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(s,o){return s=s>>>0,o||G(s,2,this.length),this[s]<<8|this[s+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(s,o){return s=s>>>0,o||G(s,4,this.length),(this[s]|this[s+1]<<8|this[s+2]<<16)+this[s+3]*16777216},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(s,o){return s=s>>>0,o||G(s,4,this.length),this[s]*16777216+(this[s+1]<<16|this[s+2]<<8|this[s+3])},l.prototype.readBigUInt64LE=Te(function(s){s=s>>>0,Xe(s,"offset");const o=this[s],f=this[s+7];(o===void 0||f===void 0)&&ft(s,this.length-8);const h=o+this[++s]*2**8+this[++s]*2**16+this[++s]*2**24,E=this[++s]+this[++s]*2**8+this[++s]*2**16+f*2**24;return BigInt(h)+(BigInt(E)<<BigInt(32))}),l.prototype.readBigUInt64BE=Te(function(s){s=s>>>0,Xe(s,"offset");const o=this[s],f=this[s+7];(o===void 0||f===void 0)&&ft(s,this.length-8);const h=o*2**24+this[++s]*2**16+this[++s]*2**8+this[++s],E=this[++s]*2**24+this[++s]*2**16+this[++s]*2**8+f;return(BigInt(h)<<BigInt(32))+BigInt(E)}),l.prototype.readIntLE=function(s,o,f){s=s>>>0,o=o>>>0,f||G(s,o,this.length);let h=this[s],E=1,_=0;for(;++_<o&&(E*=256);)h+=this[s+_]*E;return E*=128,h>=E&&(h-=Math.pow(2,8*o)),h},l.prototype.readIntBE=function(s,o,f){s=s>>>0,o=o>>>0,f||G(s,o,this.length);let h=o,E=1,_=this[s+--h];for(;h>0&&(E*=256);)_+=this[s+--h]*E;return E*=128,_>=E&&(_-=Math.pow(2,8*o)),_},l.prototype.readInt8=function(s,o){return s=s>>>0,o||G(s,1,this.length),this[s]&128?(255-this[s]+1)*-1:this[s]},l.prototype.readInt16LE=function(s,o){s=s>>>0,o||G(s,2,this.length);const f=this[s]|this[s+1]<<8;return f&32768?f|4294901760:f},l.prototype.readInt16BE=function(s,o){s=s>>>0,o||G(s,2,this.length);const f=this[s+1]|this[s]<<8;return f&32768?f|4294901760:f},l.prototype.readInt32LE=function(s,o){return s=s>>>0,o||G(s,4,this.length),this[s]|this[s+1]<<8|this[s+2]<<16|this[s+3]<<24},l.prototype.readInt32BE=function(s,o){return s=s>>>0,o||G(s,4,this.length),this[s]<<24|this[s+1]<<16|this[s+2]<<8|this[s+3]},l.prototype.readBigInt64LE=Te(function(s){s=s>>>0,Xe(s,"offset");const o=this[s],f=this[s+7];(o===void 0||f===void 0)&&ft(s,this.length-8);const h=this[s+4]+this[s+5]*2**8+this[s+6]*2**16+(f<<24);return(BigInt(h)<<BigInt(32))+BigInt(o+this[++s]*2**8+this[++s]*2**16+this[++s]*2**24)}),l.prototype.readBigInt64BE=Te(function(s){s=s>>>0,Xe(s,"offset");const o=this[s],f=this[s+7];(o===void 0||f===void 0)&&ft(s,this.length-8);const h=(o<<24)+this[++s]*2**16+this[++s]*2**8+this[++s];return(BigInt(h)<<BigInt(32))+BigInt(this[++s]*2**24+this[++s]*2**16+this[++s]*2**8+f)}),l.prototype.readFloatLE=function(s,o){return s=s>>>0,o||G(s,4,this.length),r.read(this,s,!0,23,4)},l.prototype.readFloatBE=function(s,o){return s=s>>>0,o||G(s,4,this.length),r.read(this,s,!1,23,4)},l.prototype.readDoubleLE=function(s,o){return s=s>>>0,o||G(s,8,this.length),r.read(this,s,!0,52,8)},l.prototype.readDoubleBE=function(s,o){return s=s>>>0,o||G(s,8,this.length),r.read(this,s,!1,52,8)};function $(u,s,o,f,h,E){if(!l.isBuffer(u))throw new TypeError('"buffer" argument must be a Buffer instance');if(s>h||s<E)throw new RangeError('"value" argument is out of bounds');if(o+f>u.length)throw new RangeError("Index out of range")}l.prototype.writeUintLE=l.prototype.writeUIntLE=function(s,o,f,h){if(s=+s,o=o>>>0,f=f>>>0,!h){const P=Math.pow(2,8*f)-1;$(this,s,o,f,P,0)}let E=1,_=0;for(this[o]=s&255;++_<f&&(E*=256);)this[o+_]=s/E&255;return o+f},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(s,o,f,h){if(s=+s,o=o>>>0,f=f>>>0,!h){const P=Math.pow(2,8*f)-1;$(this,s,o,f,P,0)}let E=f-1,_=1;for(this[o+E]=s&255;--E>=0&&(_*=256);)this[o+E]=s/_&255;return o+f},l.prototype.writeUint8=l.prototype.writeUInt8=function(s,o,f){return s=+s,o=o>>>0,f||$(this,s,o,1,255,0),this[o]=s&255,o+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(s,o,f){return s=+s,o=o>>>0,f||$(this,s,o,2,65535,0),this[o]=s&255,this[o+1]=s>>>8,o+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(s,o,f){return s=+s,o=o>>>0,f||$(this,s,o,2,65535,0),this[o]=s>>>8,this[o+1]=s&255,o+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(s,o,f){return s=+s,o=o>>>0,f||$(this,s,o,4,4294967295,0),this[o+3]=s>>>24,this[o+2]=s>>>16,this[o+1]=s>>>8,this[o]=s&255,o+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(s,o,f){return s=+s,o=o>>>0,f||$(this,s,o,4,4294967295,0),this[o]=s>>>24,this[o+1]=s>>>16,this[o+2]=s>>>8,this[o+3]=s&255,o+4};function zi(u,s,o,f,h){Qi(s,f,h,u,o,7);let E=Number(s&BigInt(4294967295));u[o++]=E,E=E>>8,u[o++]=E,E=E>>8,u[o++]=E,E=E>>8,u[o++]=E;let _=Number(s>>BigInt(32)&BigInt(4294967295));return u[o++]=_,_=_>>8,u[o++]=_,_=_>>8,u[o++]=_,_=_>>8,u[o++]=_,o}function Vi(u,s,o,f,h){Qi(s,f,h,u,o,7);let E=Number(s&BigInt(4294967295));u[o+7]=E,E=E>>8,u[o+6]=E,E=E>>8,u[o+5]=E,E=E>>8,u[o+4]=E;let _=Number(s>>BigInt(32)&BigInt(4294967295));return u[o+3]=_,_=_>>8,u[o+2]=_,_=_>>8,u[o+1]=_,_=_>>8,u[o]=_,o+8}l.prototype.writeBigUInt64LE=Te(function(s,o=0){return zi(this,s,o,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeBigUInt64BE=Te(function(s,o=0){return Vi(this,s,o,BigInt(0),BigInt("0xffffffffffffffff"))}),l.prototype.writeIntLE=function(s,o,f,h){if(s=+s,o=o>>>0,!h){const x=Math.pow(2,8*f-1);$(this,s,o,f,x-1,-x)}let E=0,_=1,P=0;for(this[o]=s&255;++E<f&&(_*=256);)s<0&&P===0&&this[o+E-1]!==0&&(P=1),this[o+E]=(s/_>>0)-P&255;return o+f},l.prototype.writeIntBE=function(s,o,f,h){if(s=+s,o=o>>>0,!h){const x=Math.pow(2,8*f-1);$(this,s,o,f,x-1,-x)}let E=f-1,_=1,P=0;for(this[o+E]=s&255;--E>=0&&(_*=256);)s<0&&P===0&&this[o+E+1]!==0&&(P=1),this[o+E]=(s/_>>0)-P&255;return o+f},l.prototype.writeInt8=function(s,o,f){return s=+s,o=o>>>0,f||$(this,s,o,1,127,-128),s<0&&(s=255+s+1),this[o]=s&255,o+1},l.prototype.writeInt16LE=function(s,o,f){return s=+s,o=o>>>0,f||$(this,s,o,2,32767,-32768),this[o]=s&255,this[o+1]=s>>>8,o+2},l.prototype.writeInt16BE=function(s,o,f){return s=+s,o=o>>>0,f||$(this,s,o,2,32767,-32768),this[o]=s>>>8,this[o+1]=s&255,o+2},l.prototype.writeInt32LE=function(s,o,f){return s=+s,o=o>>>0,f||$(this,s,o,4,2147483647,-2147483648),this[o]=s&255,this[o+1]=s>>>8,this[o+2]=s>>>16,this[o+3]=s>>>24,o+4},l.prototype.writeInt32BE=function(s,o,f){return s=+s,o=o>>>0,f||$(this,s,o,4,2147483647,-2147483648),s<0&&(s=4294967295+s+1),this[o]=s>>>24,this[o+1]=s>>>16,this[o+2]=s>>>8,this[o+3]=s&255,o+4},l.prototype.writeBigInt64LE=Te(function(s,o=0){return zi(this,s,o,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),l.prototype.writeBigInt64BE=Te(function(s,o=0){return Vi(this,s,o,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function ji(u,s,o,f,h,E){if(o+f>u.length)throw new RangeError("Index out of range");if(o<0)throw new RangeError("Index out of range")}function Xi(u,s,o,f,h){return s=+s,o=o>>>0,h||ji(u,s,o,4),r.write(u,s,o,f,23,4),o+4}l.prototype.writeFloatLE=function(s,o,f){return Xi(this,s,o,!0,f)},l.prototype.writeFloatBE=function(s,o,f){return Xi(this,s,o,!1,f)};function $i(u,s,o,f,h){return s=+s,o=o>>>0,h||ji(u,s,o,8),r.write(u,s,o,f,52,8),o+8}l.prototype.writeDoubleLE=function(s,o,f){return $i(this,s,o,!0,f)},l.prototype.writeDoubleBE=function(s,o,f){return $i(this,s,o,!1,f)},l.prototype.copy=function(s,o,f,h){if(!l.isBuffer(s))throw new TypeError("argument should be a Buffer");if(f||(f=0),!h&&h!==0&&(h=this.length),o>=s.length&&(o=s.length),o||(o=0),h>0&&h<f&&(h=f),h===f||s.length===0||this.length===0)return 0;if(o<0)throw new RangeError("targetStart out of bounds");if(f<0||f>=this.length)throw new RangeError("Index out of range");if(h<0)throw new RangeError("sourceEnd out of bounds");h>this.length&&(h=this.length),s.length-o<h-f&&(h=s.length-o+f);const E=h-f;return this===s&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(o,f,h):Uint8Array.prototype.set.call(s,this.subarray(f,h),o),E},l.prototype.fill=function(s,o,f,h){if(typeof s=="string"){if(typeof o=="string"?(h=o,o=0,f=this.length):typeof f=="string"&&(h=f,f=this.length),h!==void 0&&typeof h!="string")throw new TypeError("encoding must be a string");if(typeof h=="string"&&!l.isEncoding(h))throw new TypeError("Unknown encoding: "+h);if(s.length===1){const _=s.charCodeAt(0);(h==="utf8"&&_<128||h==="latin1")&&(s=_)}}else typeof s=="number"?s=s&255:typeof s=="boolean"&&(s=Number(s));if(o<0||this.length<o||this.length<f)throw new RangeError("Out of range index");if(f<=o)return this;o=o>>>0,f=f===void 0?this.length:f>>>0,s||(s=0);let E;if(typeof s=="number")for(E=o;E<f;++E)this[E]=s;else{const _=l.isBuffer(s)?s:l.from(s,h),P=_.length;if(P===0)throw new TypeError('The value "'+s+'" is invalid for argument "value"');for(E=0;E<f-o;++E)this[E+o]=_[E%P]}return this};const je={};function Pr(u,s,o){je[u]=class extends o{constructor(){super();Object.defineProperty(this,"message",{value:s.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${u}]`,this.stack,delete this.name}get code(){return u}set code(h){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:h,writable:!0})}toString(){return`${this.name} [${u}]: ${this.message}`}}}Pr("ERR_BUFFER_OUT_OF_BOUNDS",function(u){return u?`${u} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),Pr("ERR_INVALID_ARG_TYPE",function(u,s){return`The "${u}" argument must be of type number. Received type ${typeof s}`},TypeError),Pr("ERR_OUT_OF_RANGE",function(u,s,o){let f=`The value of "${u}" is out of range.`,h=o;return Number.isInteger(o)&&Math.abs(o)>2**32?h=Ki(String(o)):typeof o=="bigint"&&(h=String(o),(o>BigInt(2)**BigInt(32)||o<-(BigInt(2)**BigInt(32)))&&(h=Ki(h)),h+="n"),f+=` It must be ${s}. Received ${h}`,f},RangeError);function Ki(u){let s="",o=u.length;const f=u[0]==="-"?1:0;for(;o>=f+4;o-=3)s=`_${u.slice(o-3,o)}${s}`;return`${u.slice(0,o)}${s}`}function Rc(u,s,o){Xe(s,"offset"),(u[s]===void 0||u[s+o]===void 0)&&ft(s,u.length-(o+1))}function Qi(u,s,o,f,h,E){if(u>o||u<s){const _=typeof s=="bigint"?"n":"";let P;throw E>3?s===0||s===BigInt(0)?P=`>= 0${_} and < 2${_} ** ${(E+1)*8}${_}`:P=`>= -(2${_} ** ${(E+1)*8-1}${_}) and < 2 ** ${(E+1)*8-1}${_}`:P=`>= ${s}${_} and <= ${o}${_}`,new je.ERR_OUT_OF_RANGE("value",P,u)}Rc(f,h,E)}function Xe(u,s){if(typeof u!="number")throw new je.ERR_INVALID_ARG_TYPE(s,"number",u)}function ft(u,s,o){throw Math.floor(u)!==u?(Xe(u,o),new je.ERR_OUT_OF_RANGE(o||"offset","an integer",u)):s<0?new je.ERR_BUFFER_OUT_OF_BOUNDS:new je.ERR_OUT_OF_RANGE(o||"offset",`>= ${o?1:0} and <= ${s}`,u)}const Ic=/[^+/0-9A-Za-z-_]/g;function wc(u){if(u=u.split("=")[0],u=u.trim().replace(Ic,""),u.length<2)return"";for(;u.length%4!==0;)u=u+"=";return u}function Mr(u,s){s=s||1/0;let o;const f=u.length;let h=null;const E=[];for(let _=0;_<f;++_){if(o=u.charCodeAt(_),o>55295&&o<57344){if(!h){if(o>56319){(s-=3)>-1&&E.push(239,191,189);continue}else if(_+1===f){(s-=3)>-1&&E.push(239,191,189);continue}h=o;continue}if(o<56320){(s-=3)>-1&&E.push(239,191,189),h=o;continue}o=(h-55296<<10|o-56320)+65536}else h&&(s-=3)>-1&&E.push(239,191,189);if(h=null,o<128){if((s-=1)<0)break;E.push(o)}else if(o<2048){if((s-=2)<0)break;E.push(o>>6|192,o&63|128)}else if(o<65536){if((s-=3)<0)break;E.push(o>>12|224,o>>6&63|128,o&63|128)}else if(o<1114112){if((s-=4)<0)break;E.push(o>>18|240,o>>12&63|128,o>>6&63|128,o&63|128)}else throw new Error("Invalid code point")}return E}function Oc(u){const s=[];for(let o=0;o<u.length;++o)s.push(u.charCodeAt(o)&255);return s}function Pc(u,s){let o,f,h;const E=[];for(let _=0;_<u.length&&!((s-=2)<0);++_)o=u.charCodeAt(_),f=o>>8,h=o%256,E.push(h),E.push(f);return E}function Wi(u){return e.toByteArray(wc(u))}function Gt(u,s,o,f){let h;for(h=0;h<f&&!(h+o>=s.length||h>=u.length);++h)s[h+o]=u[h];return h}function fe(u,s){return u instanceof s||u!=null&&u.constructor!=null&&u.constructor.name!=null&&u.constructor.name===s.name}function Cr(u){return u!==u}const Mc=function(){const u="0123456789abcdef",s=new Array(256);for(let o=0;o<16;++o){const f=o*16;for(let h=0;h<16;++h)s[f+h]=u[o]+u[h]}return s}();function Te(u){return typeof BigInt=="undefined"?Cc:u}function Cc(){throw new Error("BigInt not supported")}})(Lr),Object.defineProperty(se,"__esModule",{value:!0}),se.LiteBuffer=se.Buffer=void 0;var xr=Qs(Lr);function Qs(t){return t&&t.__esModule?t:{default:t}}const Kt=typeof V!="undefined"&&V.hasOwnProperty("Buffer"),Br=xr.default.hasOwnProperty("Buffer");function Ws(t){const e=t?`Not implemented: ${t}`:"Not implemented";throw new Error(e)}function Qt(t){return t==null||t==="utf8"||t==="utf-8"?"utf8":Js(t)}function We(t,e){return t instanceof e||t!=null&&t.constructor!=null&&t.constructor.name!=null&&t.constructor.name===e.name}function Js(t){switch(t.length){case 4:if(t==="UTF8")return"utf8";if(t==="ucs2"||t==="UCS2")return"utf16le";if(t=`${t}`.toLowerCase(),t==="utf8")return"utf8";if(t==="ucs2")return"utf16le";break;case 3:if(t==="hex"||t==="HEX"||`${t}`.toLowerCase()==="hex")return"hex";break;case 5:if(t==="ascii")return"ascii";if(t==="ucs-2")return"utf16le";if(t==="UTF-8")return"utf8";if(t==="ASCII")return"ascii";if(t==="UCS-2")return"utf16le";if(t=`${t}`.toLowerCase(),t==="utf-8")return"utf8";if(t==="ascii")return"ascii";if(t==="ucs-2")return"utf16le";break;case 6:if(t==="base64")return"base64";if(t==="latin1"||t==="binary")return"latin1";if(t==="BASE64")return"base64";if(t==="LATIN1"||t==="BINARY")return"latin1";if(t=`${t}`.toLowerCase(),t==="base64")return"base64";if(t==="latin1"||t==="binary")return"latin1";break;case 7:if(t==="utf16le"||t==="UTF16LE"||`${t}`.toLowerCase()==="utf16le")return"utf16le";break;case 8:if(t==="utf-16le"||t==="UTF-16LE"||`${t}`.toLowerCase()==="utf-16le")return"utf16le";break;default:if(t==="")return"utf8"}}const Zs=["base64","hex","ascii","binary","latin1","ucs2","utf16le"];function Je(t="utf8",e=!0){if(typeof t!="string"||e&&t===""){if(!e)return"utf8";throw new TypeError(`Unknown encoding: ${t}`)}const r=Qt(t);if(r===void 0)throw new TypeError(`Unknown encoding: ${t}`);return Zs.includes(t)&&Ws(`"${t}" encoding`),r}const eo={ascii:{byteLength:t=>t.length},base64:{byteLength:t=>to(t,t.length)},hex:{byteLength:t=>t.length>>>1},latin1:{byteLength:t=>t.length},ucs2:{byteLength:t=>t.length*2},utf16le:{byteLength:t=>t.length*2},utf8:{byteLength:t=>Wt(t).length}};function to(t,e){return t.charCodeAt(e-1)===61&&e--,e>1&&t.charCodeAt(e-1)===61&&e--,e*3>>>2}const Dr=4096;function ro(t){const e=t.length;if(e<=Dr)return String.fromCharCode.apply(String,t);let r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=Dr));return r}function Wt(t,e=1/0){let r=e,n;const i=t.length;let a=null;const c=[];for(let l=0;l<i;++l){if(n=t.charCodeAt(l),n>55295&&n<57344){if(!a){if(n>56319){(r-=3)>-1&&c.push(239,191,189);continue}else if(l+1===i){(r-=3)>-1&&c.push(239,191,189);continue}a=n;continue}if(n<56320){(r-=3)>-1&&c.push(239,191,189),a=n;continue}n=(a-55296<<10|n-56320)+65536}else a&&(r-=3)>-1&&c.push(239,191,189);if(a=null,n<128){if((r-=1)<0)break;c.push(n)}else if(n<2048){if((r-=2)<0)break;c.push(n>>6|192,n&63|128)}else if(n<65536){if((r-=3)<0)break;c.push(n>>12|224,n>>6&63|128,n&63|128)}else if(n<1114112){if((r-=4)<0)break;c.push(n>>18|240,n>>12&63|128,n>>6&63|128,n&63|128)}else throw new Error("Invalid code point")}return c}function no(t,e,r){r=Math.min(t.length,r);const n=[];let i=e;for(;i<r;){const a=t[i];let c=null,l=a>239?4:a>223?3:a>191?2:1;if(i+l<=r){let d,S,y,A;switch(l){case 1:a<128&&(c=a);break;case 2:d=t[i+1],(d&192)===128&&(A=(a&31)<<6|d&63,A>127&&(c=A));break;case 3:d=t[i+1],S=t[i+2],(d&192)===128&&(S&192)===128&&(A=(a&15)<<12|(d&63)<<6|S&63,A>2047&&(A<55296||A>57343)&&(c=A));break;case 4:d=t[i+1],S=t[i+2],y=t[i+3],(d&192)===128&&(S&192)===128&&(y&192)===128&&(A=(a&15)<<18|(d&63)<<12|(S&63)<<6|y&63,A>65535&&A<1114112&&(c=A))}}c===null?(c=65533,l=1):c>65535&&(c-=65536,n.push(c>>>10&1023|55296),c=56320|c&1023),n.push(c),i+=l}return ro(n)}function io(t,e,r,n){return so(Wt(e,t.length-r),t,r,n)}function so(t,e,r,n){let i=0;for(;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}class j extends Uint8Array{constructor(e,r,n){if(typeof e=="number")super(e);else{const i=r||0,a=n||(We(e,Array)?e.length:e.byteLength);super(e,i,a)}}static alloc(e,r=0,n="utf8"){if(typeof e!="number")throw new TypeError(`The "size" argument must be of type number. Received type ${typeof e}`);const i=new j(e);if(e===0)return i;let a;if(typeof r=="string")n=Je(n),r.length===1&&n==="utf8"?i.fill(r.charCodeAt(0)):a=j.from(r,n);else if(typeof r=="number")i.fill(r);else if(We(r,Uint8Array)){if(r.length===0)throw new TypeError(`The argument "value" is invalid. Received ${r.constructor.name} []`);a=r}if(a){a.length>i.length&&(a=a.subarray(0,i.length));let c=0;for(;c<e&&(i.set(a,c),c+=a.length,!(c+a.length>=e)););c!==e&&i.set(a.subarray(0,e-c),c)}return i}static allocUnsafe(e){return new j(e)}static byteLength(e,r="utf8"){return typeof e!="string"?e.byteLength:(r=Qt(r)||"utf8",eo[r].byteLength(e))}static concat(e,r){if(r==null){r=0;for(const a of e)r+=a.length}const n=new j(r);let i=0;for(const a of e)n.set(a,i),i+=a.length;return n}static from(e,r,n){const i=typeof r=="string"?void 0:r;let a=typeof r=="string"?r:void 0;if(typeof e=="string"||e.constructor.name==="String")switch(e=e.toString(),a=Je(a,!1),a){case"utf8":return typeof TextEncoder!="undefined"?new j(new TextEncoder().encode(e).buffer):new j(Wt(e));default:throw new TypeError("Unknown encoding: "+a)}return new j(e,i,n)}static isBuffer(e){return We(e,j)||!Kt&&Br&&We(e,Uint8Array)}static isEncoding(e){return typeof e=="string"&&e.length!==0&&Qt(e)!==void 0}copy(e,r=0,n=0,i=this.length){const a=this.subarray(n,i);return e.set(a,r),a.length}equals(e){if(!We(e,Uint8Array))throw new TypeError(`The "otherBuffer" argument must be an instance of Buffer or Uint8Array. Received type ${typeof e}`);if(this===e)return!0;if(this.byteLength!==e.byteLength)return!1;for(let r=0;r<this.length;r++)if(this[r]!==e[r])return!1;return!0}readDoubleBE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getFloat64(e)}readDoubleLE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getFloat64(e,!0)}readFloatBE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getFloat32(e)}readFloatLE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getFloat32(e,!0)}readInt8(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getInt8(e)}readInt16BE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getInt16(e)}readInt16LE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getInt16(e,!0)}readInt32BE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getInt32(e)}readInt32LE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getInt32(e,!0)}readUInt8(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getUint8(e)}readUInt16BE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getUint16(e)}readUInt16LE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getUint16(e,!0)}readUInt32BE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getUint32(e)}readUInt32LE(e=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).getUint32(e,!0)}slice(e=0,r=this.length){return this.subarray(e,r)}subarray(e=0,r=this.length){return new j(super.subarray(e,r))}toJSON(){return{data:Array.from(this),type:"Buffer"}}toString(e="utf8",r=0,n=this.length){if(e=Je(e),typeof TextDecoder!="undefined"){const i=this.subarray(r,n);return new TextDecoder().decode(i)}return this.slowToString(e,r,n)}slowToString(e="utf8",r=0,n=this.length){if((r===void 0||r<0)&&(r=0),r>this.length||((n===void 0||n>this.length)&&(n=this.length),n<=0)||(n>>>=0,r>>>=0,n<=r))return"";switch(e=Je(e),e){case"utf8":return no(this,r,n);default:throw new TypeError("Unsupported encoding: "+e)}}write(e,r=0,n=this.length,i="utf8"){switch(i=Je(i),i){case"utf8":if(typeof TextEncoder!="undefined"){const a=new TextEncoder().encode(e);return this.set(a,r),a.byteLength>n-r?n-r:a.byteLength}return io(this,e,r,n);default:throw new TypeError("Unknown encoding: "+i)}}writeDoubleBE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setFloat64(r,e),r+8}writeDoubleLE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setFloat64(r,e,!0),r+8}writeFloatBE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setFloat32(r,e),r+4}writeFloatLE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setFloat32(r,e,!0),r+4}writeInt8(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setInt8(r,e),r+1}writeInt16BE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setInt16(r,e),r+2}writeInt16LE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setInt16(r,e,!0),r+2}writeInt32BE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint32(r,e),r+4}writeInt32LE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setInt32(r,e,!0),r+4}writeUInt8(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint8(r,e),r+1}writeUInt16BE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint16(r,e),r+2}writeUInt16LE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint16(r,e,!0),r+2}writeUInt32BE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint32(r,e),r+4}writeUInt32LE(e,r=0){return new DataView(this.buffer,this.byteOffset,this.byteLength).setUint32(r,e,!0),r+4}}se.Buffer=j,Kt||(Br&&Object.defineProperty(xr.default,"Buffer",{configurable:!0,enumerable:!1,value:j,writable:!0}),Object.defineProperty(window,"Buffer",{configurable:!0,enumerable:!1,value:j,writable:!0}));const oo=Kt?V.Buffer:j;se.LiteBuffer=oo,Object.defineProperty(K,"__esModule",{value:!0}),K.IdentitySerializers=K.IdentitySerializer=K.JsonSerializers=K.JsonSerializer=void 0;var Jt=se,ao=uo(Oe);function uo(t){return t&&t.__esModule?t:{default:t}}const Zt={deserialize:t=>{let e;return t==null?null:(typeof t=="string"?e=t:Jt.LiteBuffer.isBuffer(t)?e=t.toString("utf8"):e=Jt.LiteBuffer.from(t).toString("utf8"),JSON.parse(e))},serialize:JSON.stringify};K.JsonSerializer=Zt;const co={data:Zt,metadata:Zt};K.JsonSerializers=co;const er={deserialize:t=>((0,ao.default)(t==null||typeof t=="string"||Jt.LiteBuffer.isBuffer(t)||t instanceof Uint8Array,"RSocketSerialization: Expected data to be a string, Buffer, or Uint8Array. Got `%s`.",t),t),serialize:t=>t};K.IdentitySerializer=er;const lo={data:er,metadata:er};K.IdentitySerializers=lo;var ne={};Object.defineProperty(ne,"__esModule",{value:!0}),ne.ResponderLeaseHandler=ne.RequesterLeaseHandler=ne.Leases=ne.Lease=void 0;var kr=ho(Oe),Gr=Ie,fo=g;function ho(t){return t&&t.__esModule?t:{default:t}}function tr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class Yr{constructor(e,r,n){(0,kr.default)(e>0,"Lease time-to-live must be positive"),(0,kr.default)(r>0,"Lease allowed requests must be positive"),this.timeToLiveMillis=e,this.allowedRequests=r,this.startingAllowedRequests=r,this.expiry=Date.now()+e,this.metadata=n}expired(){return Date.now()>this.expiry}valid(){return this.allowedRequests>0&&!this.expired()}_use(){if(this.expired())return!1;const e=this.allowedRequests,r=e>0;return r&&(this.allowedRequests=e-1),r}}ne.Lease=Yr;class Eo{constructor(){tr(this,"_sender",()=>Gr.Flowable.never()),tr(this,"_receiver",e=>{})}sender(e){return this._sender=e,this}receiver(e){return this._receiver=e,this}stats(e){return this._stats=e,this}}ne.Leases=Eo;class _o{constructor(e){tr(this,"_requestN",-1),e(new Gr.Flowable(r=>{if(this._subscriber){r.onError(new Error("only 1 subscriber is allowed"));return}if(this.isDisposed()){r.onComplete();return}this._subscriber=r,r.onSubscribe({cancel:()=>{this.dispose()},request:n=>{if(n<=0&&r.onError(new Error(`request demand must be positive: ${n}`)),!this.isDisposed()){const i=this._requestN;this._onRequestN(i),this._requestN=Math.min(Number.MAX_SAFE_INTEGER,Math.max(0,i)+n)}}})}))}use(){const e=this._lease;return e?e._use():!1}errorMessage(){return qr(this._lease)}receive(e){if(!this.isDisposed()){const r=e.ttl,n=e.requestCount,i=e.metadata;this._onLease(new Yr(r,n,i))}}availability(){const e=this._lease;return e&&e.valid()?e.allowedRequests/e.startingAllowedRequests:0}dispose(){if(!this._isDisposed){this._isDisposed=!0;const e=this._subscriber;e&&e.onComplete()}}isDisposed(){return this._isDisposed}_onRequestN(e){const r=this._lease,n=this._subscriber;e<0&&r&&n&&n.onNext(r)}_onLease(e){const r=this._subscriber,n=this._requestN-1;n>=0&&r&&r.onNext(e),this._requestN=Math.max(-1,n),this._lease=e}}ne.RequesterLeaseHandler=_o;class po{constructor(e,r,n){this._leaseSender=e,this._stats=r,this._errorConsumer=n}use(){const e=this._lease,r=e?e._use():!1;return this._onStatsEvent(r),r}errorMessage(){return qr(this._lease)}send(e){let r,n;return this._leaseSender(this._stats).subscribe({onComplete:()=>this._onStatsEvent(),onError:i=>{this._onStatsEvent();const a=this._errorConsumer;a&&a(i)},onNext:i=>{this._lease=i,e(i)},onSubscribe:i=>{if(n){i.cancel();return}i.request(fo.MAX_REQUEST_N),r=i}}),{dispose(){n||(n=!0,this._onStatsEvent(),r&&r.cancel())},isDisposed(){return n}}}_onStatsEvent(e){const r=this._stats;if(r){const n=e===void 0?"Terminate":e?"Accept":"Reject";r.onEvent(n)}}}ne.ResponderLeaseHandler=po;function qr(t){if(!t)return"Lease was not received yet";if(t.valid())return"Missing leases";{const e=t.expired(),r=t.allowedRequests;return`Missing leases. Expired: ${e.toString()}, allowedRequests: ${r}`}}Object.defineProperty(Qe,"__esModule",{value:!0}),Qe.createServerMachine=yo,Qe.createClientMachine=bo;var Q=Ie,b=g,So=K;function Hr(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function zr(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Hr(Object(r),!0).forEach(function(n){Ze(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):Hr(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function Ze(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class mo{constructor(e){this._responder=e||{}}setResponder(e){this._responder=e||{}}fireAndForget(e){if(this._responder.fireAndForget)try{this._responder.fireAndForget(e)}catch(r){console.error("fireAndForget threw an exception",r)}}requestResponse(e){let r;if(this._responder.requestResponse)try{return this._responder.requestResponse(e)}catch(n){console.error("requestResponse threw an exception",n),r=n}return Q.Single.error(r||new Error("not implemented"))}requestStream(e){let r;if(this._responder.requestStream)try{return this._responder.requestStream(e)}catch(n){console.error("requestStream threw an exception",n),r=n}return Q.Flowable.error(r||new Error("not implemented"))}requestChannel(e){let r;if(this._responder.requestChannel)try{return this._responder.requestChannel(e)}catch(n){console.error("requestChannel threw an exception",n),r=n}return Q.Flowable.error(r||new Error("not implemented"))}metadataPush(e){let r;if(this._responder.metadataPush)try{return this._responder.metadataPush(e)}catch(n){console.error("metadataPush threw an exception",n),r=n}return Q.Single.error(r||new Error("not implemented"))}}function yo(t,e,r,n,i,a,c){return new Vr("SERVER",t,e,r,n,void 0,i,a,c)}function bo(t,e,r,n,i,a,c,l){return new Vr("CLIENT",t,e,r,n,i,a,c,l)}class Vr{constructor(e,r,n,i,a,c,l,d,S){Ze(this,"_connectionAvailability",1),Ze(this,"_handleTransportClose",()=>{this._handleError(new Error("RSocket: The connection was closed."))}),Ze(this,"_handleError",R=>{this._receivers.forEach(M=>{M.onError(R)}),this._receivers.clear(),this._subscriptions.forEach(M=>{M.cancel()}),this._subscriptions.clear(),this._connectionAvailability=0,this._dispose(this._requesterLeaseHandler,this._responderLeaseSenderDisposable);const w=this._keepAliveTimerHandle;w&&(clearTimeout(w),this._keepAliveTimerHandle=null)}),Ze(this,"_handleFrame",R=>{const{streamId:w}=R;w===b.CONNECTION_STREAM_ID?this._handleConnectionFrame(R):this._handleStreamFrame(w,R)}),this._connection=r,this._requesterLeaseHandler=d,this._responderLeaseHandler=S,this._nextStreamId=e==="CLIENT"?1:2,this._receivers=new Map,this._subscriptions=new Map,this._serializers=a||So.IdentitySerializers,this._requestHandler=new mo(c),this._errorHandler=l,n({onComplete:this._handleTransportClose,onError:this._handleError,onNext:this._handleFrame,onSubscribe:R=>R.request(Number.MAX_SAFE_INTEGER)});const y=this._responderLeaseHandler;y&&(this._responderLeaseSenderDisposable=y.send(this._leaseFrameSender())),this._connection.connectionStatus().subscribe({onNext:R=>{R.kind==="CLOSED"?this._handleTransportClose():R.kind==="ERROR"&&this._handleError(R.error)},onSubscribe:R=>R.request(Number.MAX_SAFE_INTEGER)});const A=100;this._keepAliveLastReceivedMillis=Date.now();const T=()=>{const w=Date.now()-this._keepAliveLastReceivedMillis;w>=i?this._handleConnectionError(new Error(`No keep-alive acks for ${i} millis`)):this._keepAliveTimerHandle=setTimeout(T,Math.max(A,i-w))};this._keepAliveTimerHandle=setTimeout(T,i)}setRequestHandler(e){this._requestHandler.setResponder(e)}close(){this._connection.close()}connectionStatus(){return this._connection.connectionStatus()}availability(){const e=this._requesterLeaseHandler,r=e?e.availability():1;return Math.min(this._connectionAvailability,r)}fireAndForget(e){if(this._useLeaseOrError(this._requesterLeaseHandler))return;const r=this._getNextStreamId(this._receivers),n=this._serializers.data.serialize(e.data),i=this._serializers.metadata.serialize(e.metadata),a={data:n,flags:e.metadata!==void 0?b.FLAGS.METADATA:0,metadata:i,streamId:r,type:b.FRAME_TYPES.REQUEST_FNF};this._connection.sendOne(a)}requestResponse(e){const r=this._useLeaseOrError(this._requesterLeaseHandler);if(r)return Q.Single.error(new Error(r));const n=this._getNextStreamId(this._receivers);return new Q.Single(i=>{this._receivers.set(n,{onComplete:()=>{},onError:d=>i.onError(d),onNext:d=>i.onComplete(d)});const a=this._serializers.data.serialize(e.data),c=this._serializers.metadata.serialize(e.metadata),l={data:a,flags:e.metadata!==void 0?b.FLAGS.METADATA:0,metadata:c,streamId:n,type:b.FRAME_TYPES.REQUEST_RESPONSE};this._connection.sendOne(l),i.onSubscribe(()=>{this._receivers.delete(n);const d={flags:0,streamId:n,type:b.FRAME_TYPES.CANCEL};this._connection.sendOne(d)})})}requestStream(e){const r=this._useLeaseOrError(this._requesterLeaseHandler);if(r)return Q.Flowable.error(new Error(r));const n=this._getNextStreamId(this._receivers);return new Q.Flowable(i=>{this._receivers.set(n,i);let a=!1;i.onSubscribe({cancel:()=>{if(this._receivers.delete(n),!a)return;const c={flags:0,streamId:n,type:b.FRAME_TYPES.CANCEL};this._connection.sendOne(c)},request:c=>{if(c>b.MAX_REQUEST_N&&(c=b.MAX_REQUEST_N),a){const l={flags:0,requestN:c,streamId:n,type:b.FRAME_TYPES.REQUEST_N};this._connection.sendOne(l)}else{a=!0;const l=this._serializers.data.serialize(e.data),d=this._serializers.metadata.serialize(e.metadata),S={data:l,flags:e.metadata!==void 0?b.FLAGS.METADATA:0,metadata:d,requestN:c,streamId:n,type:b.FRAME_TYPES.REQUEST_STREAM};this._connection.sendOne(S)}}})},b.MAX_REQUEST_N)}requestChannel(e){const r=this._useLeaseOrError(this._requesterLeaseHandler);if(r)return Q.Flowable.error(new Error(r));const n=this._getNextStreamId(this._receivers);let i=!1;return new Q.Flowable(a=>{try{this._receivers.set(n,a);let c=!1;a.onSubscribe({cancel:()=>{if(this._receivers.delete(n),!c)return;const l={flags:0,streamId:n,type:b.FRAME_TYPES.CANCEL};this._connection.sendOne(l)},request:l=>{if(l>b.MAX_REQUEST_N&&(l=b.MAX_REQUEST_N),c){const d={flags:0,requestN:l,streamId:n,type:b.FRAME_TYPES.REQUEST_N};this._connection.sendOne(d)}else i?console.warn("RSocketClient: re-entrant call to request n before initial channel established."):(i=!0,e.subscribe({onComplete:()=>{this._sendStreamComplete(n)},onError:d=>{this._sendStreamError(n,d.message)},onNext:d=>{const S=this._serializers.data.serialize(d.data),y=this._serializers.metadata.serialize(d.metadata);if(c){const A={data:S,flags:b.FLAGS.NEXT|(d.metadata!==void 0?b.FLAGS.METADATA:0),metadata:y,streamId:n,type:b.FRAME_TYPES.PAYLOAD};this._connection.sendOne(A)}else{c=!0;const A={data:S,flags:d.metadata!==void 0?b.FLAGS.METADATA:0,metadata:y,requestN:l,streamId:n,type:b.FRAME_TYPES.REQUEST_CHANNEL};this._connection.sendOne(A)}},onSubscribe:d=>{this._subscriptions.set(n,d),d.request(1)}}))}})}catch(c){console.warn("Exception while subscribing to channel flowable:"+c)}},b.MAX_REQUEST_N)}metadataPush(e){return new Q.Single(r=>{const n=this._serializers.metadata.serialize(e.metadata),i={flags:0,metadata:n,streamId:0,type:b.FRAME_TYPES.METADATA_PUSH};this._connection.sendOne(i),r.onSubscribe(()=>{}),r.onComplete()})}_getNextStreamId(e){const r=this._nextStreamId;do this._nextStreamId=this._nextStreamId+2&b.MAX_STREAM_ID;while(this._nextStreamId===0||e.has(r));return r}_useLeaseOrError(e){if(e&&!e.use())return e.errorMessage()}_leaseFrameSender(){return e=>this._connection.sendOne({flags:0,metadata:e.metadata,requestCount:e.allowedRequests,streamId:b.CONNECTION_STREAM_ID,ttl:e.timeToLiveMillis,type:b.FRAME_TYPES.LEASE})}_dispose(...e){e.forEach(r=>{r&&r.dispose()})}_isRequest(e){switch(e){case b.FRAME_TYPES.REQUEST_FNF:case b.FRAME_TYPES.REQUEST_RESPONSE:case b.FRAME_TYPES.REQUEST_STREAM:case b.FRAME_TYPES.REQUEST_CHANNEL:return!0;default:return!1}}_handleConnectionError(e){this._handleError(e),this._connection.close();const r=this._errorHandler;r&&r(e)}_handleConnectionFrame(e){switch(e.type){case b.FRAME_TYPES.ERROR:const r=(0,b.createErrorFromFrame)(e);this._handleConnectionError(r);break;case b.FRAME_TYPES.EXT:break;case b.FRAME_TYPES.KEEPALIVE:this._keepAliveLastReceivedMillis=Date.now(),(0,b.isRespond)(e.flags)&&this._connection.sendOne(zr(zr({},e),{},{flags:e.flags^b.FLAGS.RESPOND,lastReceivedPosition:0}));break;case b.FRAME_TYPES.LEASE:const n=this._requesterLeaseHandler;n&&n.receive(e);break;case b.FRAME_TYPES.METADATA_PUSH:this._handleMetadataPush(e);break;case b.FRAME_TYPES.REQUEST_CHANNEL:case b.FRAME_TYPES.REQUEST_FNF:case b.FRAME_TYPES.REQUEST_RESPONSE:case b.FRAME_TYPES.REQUEST_STREAM:break;case b.FRAME_TYPES.RESERVED:break;case b.FRAME_TYPES.RESUME:case b.FRAME_TYPES.RESUME_OK:break}}_handleStreamFrame(e,r){if(this._isRequest(r.type)){const n=this._useLeaseOrError(this._responderLeaseHandler);if(n){this._sendStreamError(e,n);return}}switch(r.type){case b.FRAME_TYPES.CANCEL:this._handleCancel(e,r);break;case b.FRAME_TYPES.REQUEST_N:this._handleRequestN(e,r);break;case b.FRAME_TYPES.REQUEST_FNF:this._handleFireAndForget(e,r);break;case b.FRAME_TYPES.REQUEST_RESPONSE:this._handleRequestResponse(e,r);break;case b.FRAME_TYPES.REQUEST_STREAM:this._handleRequestStream(e,r);break;case b.FRAME_TYPES.REQUEST_CHANNEL:this._handleRequestChannel(e,r);break;case b.FRAME_TYPES.ERROR:const n=(0,b.createErrorFromFrame)(r);this._handleStreamError(e,n);break;case b.FRAME_TYPES.PAYLOAD:const i=this._receivers.get(e);if(i!=null){if((0,b.isNext)(r.flags)){const a={data:this._serializers.data.deserialize(r.data),metadata:this._serializers.metadata.deserialize(r.metadata)};i.onNext(a)}(0,b.isComplete)(r.flags)&&(this._receivers.delete(e),i.onComplete())}break}}_handleCancel(e,r){const n=this._subscriptions.get(e);n&&(n.cancel(),this._subscriptions.delete(e))}_handleRequestN(e,r){const n=this._subscriptions.get(e);n&&n.request(r.requestN)}_handleFireAndForget(e,r){const n=this._deserializePayload(r);this._requestHandler.fireAndForget(n)}_handleRequestResponse(e,r){const n=this._deserializePayload(r);this._requestHandler.requestResponse(n).subscribe({onComplete:i=>{this._sendStreamPayload(e,i,!0)},onError:i=>this._sendStreamError(e,i.message),onSubscribe:i=>{const a={cancel:i,request:()=>{}};this._subscriptions.set(e,a)}})}_handleRequestStream(e,r){const n=this._deserializePayload(r);this._requestHandler.requestStream(n).subscribe({onComplete:()=>this._sendStreamComplete(e),onError:i=>this._sendStreamError(e,i.message),onNext:i=>this._sendStreamPayload(e,i),onSubscribe:i=>{this._subscriptions.set(e,i),i.request(r.requestN)}})}_handleRequestChannel(e,r){if(this._subscriptions.get(e))return;const i=new Q.Flowable(c=>{let l=!0;c.onSubscribe({cancel:()=>{this._receivers.delete(e);const d={flags:0,streamId:e,type:b.FRAME_TYPES.CANCEL};this._connection.sendOne(d)},request:d=>{if(d>b.MAX_REQUEST_N&&(d=b.MAX_REQUEST_N),l&&d--,d>0){const S={flags:0,requestN:d,streamId:e,type:b.FRAME_TYPES.REQUEST_N};this._connection.sendOne(S)}l&&d>=0&&(l=!1,c.onNext(r))}})},b.MAX_REQUEST_N),a=new Q.FlowableProcessor(i,c=>this._deserializePayload(c));this._receivers.set(e,a),this._requestHandler.requestChannel(a).subscribe({onComplete:()=>this._sendStreamComplete(e),onError:c=>this._sendStreamError(e,c.message),onNext:c=>this._sendStreamPayload(e,c),onSubscribe:c=>{this._subscriptions.set(e,c),c.request(r.requestN)}})}_handleMetadataPush(e){const r=this._deserializeMetadataPushPayload(e);this._requestHandler.metadataPush(r).subscribe({onComplete:()=>{},onError:n=>{},onSubscribe:n=>{}})}_sendStreamComplete(e){this._subscriptions.delete(e),this._connection.sendOne({data:null,flags:b.FLAGS.COMPLETE,metadata:null,streamId:e,type:b.FRAME_TYPES.PAYLOAD})}_sendStreamError(e,r){this._subscriptions.delete(e),this._connection.sendOne({code:b.ERROR_CODES.APPLICATION_ERROR,flags:0,message:r,streamId:e,type:b.FRAME_TYPES.ERROR});const n=new Error(`terminated from the requester: ${r}`);this._handleStreamError(e,n)}_sendStreamPayload(e,r,n=!1){let i=b.FLAGS.NEXT;n&&(i|=b.FLAGS.COMPLETE,this._subscriptions.delete(e));const a=this._serializers.data.serialize(r.data),c=this._serializers.metadata.serialize(r.metadata);this._connection.sendOne({data:a,flags:i,metadata:c,streamId:e,type:b.FRAME_TYPES.PAYLOAD})}_deserializePayload(e){return Ao(this._serializers,e)}_deserializeMetadataPushPayload(e){return go(this._serializers,e)}_handleStreamError(e,r){const n=this._receivers.get(e);n!=null&&(this._receivers.delete(e),n.onError(r))}}function Ao(t,e){return{data:t.data.deserialize(e.data),metadata:t.metadata.deserialize(e.metadata)}}function go(t,e){return{data:null,metadata:t.metadata.deserialize(e.metadata)}}var et={};Object.defineProperty(et,"__esModule",{value:!0}),et.ReassemblyDuplexConnection=void 0;var To=se,Be=g;function Ro(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class Io{constructor(e){this._source=e}sendOne(e){this._source.sendOne(e)}send(e){this._source.send(e)}receive(){return this._source.receive().lift(e=>new wo(e))}close(){this._source.close()}connect(){this._source.connect()}connectionStatus(){return this._source.connectionStatus()}}et.ReassemblyDuplexConnection=Io;class wo{constructor(e){Ro(this,"_framesReassemblyMap",new Map),this._actual=e}request(e){this._subscription.request(e)}cancel(){this._subscription.cancel(),this._framesReassemblyMap.clear()}onSubscribe(e){this._subscription==null?(this._subscription=e,this._actual.onSubscribe(this)):e.cancel()}onComplete(){this._actual.onComplete()}onError(e){this._actual.onError(e)}onNext(e){const r=e.streamId;if(r!==Be.CONNECTION_STREAM_ID){const n=(0,Be.isFollows)(e.flags),i=(0,Be.isComplete)(e.flags),a=e.type===Be.FRAME_TYPES.ERROR||e.type===Be.FRAME_TYPES.CANCEL,c=this._framesReassemblyMap.get(r);if(c)if(a)this._framesReassemblyMap.delete(r);else{c.metadata&&e.metadata&&(c.metadata=jr(c.metadata,e.metadata)),c.data&&e.data?c.data=jr(c.data,e.data):!c.data&&e.data&&(c.data=e.data),(!n||i)&&(i&&(c.flags|=Be.FLAGS.COMPLETE),this._framesReassemblyMap.delete(r),this._actual.onNext(c));return}else if(n&&!i&&!a){this._framesReassemblyMap.set(r,e);return}}this._actual.onNext(e)}}const jr=(t,e)=>{switch(t.constructor.name){case"String":return t+e;case"Uint8Array":const r=new Uint8Array(t.length+e.length);return r.set(t),r.set(e,t.length),r;default:return To.LiteBuffer.concat([t,e])}};Object.defineProperty(ht,"__esModule",{value:!0}),ht.default=void 0;var Xr=Ie,Oo=No(Oe),Pe=g,$r=Ue,Po=Qe,Kr=ne,Mo=K,Co=et;function No(t){return t&&t.__esModule?t:{default:t}}class vo{constructor(e){this._checkConfig(e),this._cancel=null,this._config=e,this._connection=null,this._socket=null}close(){this._config.transport.close()}connect(){return(0,Oo.default)(!this._connection,"RSocketClient: Unexpected call to connect(), already connected."),this._connection=new Xr.Single(e=>{const r=this._config.transport;let n;r.connectionStatus().subscribe({onNext:i=>{i.kind==="CONNECTED"?(n&&n.cancel(),e.onComplete(new Fo(this._config,new Co.ReassemblyDuplexConnection(r)))):i.kind==="ERROR"?(n&&n.cancel(),e.onError(i.error)):i.kind==="CLOSED"&&(n&&n.cancel(),e.onError(new Error("RSocketClient: Connection closed.")))},onSubscribe:i=>{n=i,e.onSubscribe(()=>{i.cancel(),r.close()}),n.request(Number.MAX_SAFE_INTEGER)}}),r.connect()}),this._connection}_checkConfig(e){const r=e.setup,n=r&&r.keepAlive;try{const i=window&&window.navigator;n>3e4&&i&&i.userAgent&&(i.userAgent.includes("Trident")||i.userAgent.includes("Edg"))&&console.warn("rsocket-js: Due to a browser bug, Internet Explorer and Edge users may experience WebSocket instability with keepAlive values longer than 30 seconds.")}catch{}}}ht.default=vo;class Fo{constructor(e,r){let n,i;const a=e.leases;if(a){const S=a();n=new Kr.RequesterLeaseHandler(S._receiver),i=new Kr.ResponderLeaseHandler(S._sender,S._stats)}const{keepAlive:c,lifetime:l}=e.setup;this._machine=(0,Po.createClientMachine)(r,S=>r.receive().subscribe(S),l,e.serializers,e.responder,e.errorHandler,n,i),r.sendOne(this._buildSetupFrame(e));const d=(0,Xr.every)(c).map(()=>({data:null,flags:Pe.FLAGS.RESPOND,lastReceivedPosition:0,streamId:Pe.CONNECTION_STREAM_ID,type:Pe.FRAME_TYPES.KEEPALIVE}));r.send(d)}fireAndForget(e){this._machine.fireAndForget(e)}requestResponse(e){return this._machine.requestResponse(e)}requestStream(e){return this._machine.requestStream(e)}requestChannel(e){return this._machine.requestChannel(e)}metadataPush(e){return this._machine.metadataPush(e)}close(){this._machine.close()}connectionStatus(){return this._machine.connectionStatus()}availability(){return this._machine.availability()}_buildSetupFrame(e){const{dataMimeType:r,keepAlive:n,lifetime:i,metadataMimeType:a,payload:c}=e.setup,l=e.serializers||Mo.IdentitySerializers,d=c?l.data.serialize(c.data):void 0,S=c?l.metadata.serialize(c.metadata):void 0;let y=0;return S!==void 0&&(y|=Pe.FLAGS.METADATA),{data:d,dataMimeType:r,flags:y|(e.leases?Pe.FLAGS.LEASE:0),keepAlive:n,lifetime:i,majorVersion:$r.MAJOR_VERSION,metadata:S,metadataMimeType:a,minorVersion:$r.MINOR_VERSION,resumeToken:null,streamId:Pe.CONNECTION_STREAM_ID,type:Pe.FRAME_TYPES.SETUP}}}var mt={};Object.defineProperty(mt,"__esModule",{value:!0}),mt.default=void 0;var De=Bo(Oe),X=g,Lo=K,Uo=Qe,Qr=ne,xo=et;function Bo(t){return t&&t.__esModule?t:{default:t}}function rr(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class Do{constructor(e){rr(this,"_handleTransportComplete",()=>{this._handleTransportError(new Error("RSocketServer: Connection closed unexpectedly."))}),rr(this,"_handleTransportError",r=>{this._connections.forEach(n=>{n.close()})}),rr(this,"_handleTransportConnection",r=>{const n=new ko;let i;r=new xo.ReassemblyDuplexConnection(r),r.receive().subscribe(n.swap({onError:a=>console.error(a),onNext:a=>{switch(a.type){case X.FRAME_TYPES.RESUME:r.sendOne({code:X.ERROR_CODES.REJECTED_RESUME,flags:0,message:"RSocketServer: RESUME not supported.",streamId:X.CONNECTION_STREAM_ID,type:X.FRAME_TYPES.ERROR}),r.close();break;case X.FRAME_TYPES.SETUP:if(this._setupLeaseError(a)){r.sendOne({code:X.ERROR_CODES.INVALID_SETUP,flags:0,message:"RSocketServer: LEASE not supported.",streamId:X.CONNECTION_STREAM_ID,type:X.FRAME_TYPES.ERROR}),r.close();break}const c=this._getSerializers();let l,d;const S=this._config.leases;if(S){const A=S();l=new Qr.RequesterLeaseHandler(A._receiver),d=new Qr.ResponderLeaseHandler(A._sender,A._stats)}const y=(0,Uo.createServerMachine)(r,A=>{n.swap(A)},a.lifetime,c,this._config.errorHandler,l,d);try{const A=this._config.getRequestHandler(y,Go(c,a));y.setRequestHandler(A),this._connections.add(y),r.connectionStatus().subscribe({onNext:T=>{(T.kind==="CLOSED"||T.kind==="ERROR")&&this._connections.delete(y)},onSubscribe:T=>T.request(Number.MAX_SAFE_INTEGER)})}catch(A){r.sendOne({code:X.ERROR_CODES.REJECTED_SETUP,flags:0,message:"Application rejected setup, reason: "+A.message,streamId:X.CONNECTION_STREAM_ID,type:X.FRAME_TYPES.ERROR}),r.close()}break;default:(0,De.default)(!1,"RSocketServer: Expected first frame to be SETUP or RESUME, got `%s`.",(0,X.getFrameTypeName)(a.type))}},onSubscribe:a=>{i=a,i.request(1)}}))}),this._config=e,this._connections=new Set,this._started=!1,this._subscription=null}start(){(0,De.default)(!this._started,"RSocketServer: Unexpected call to start(), already started."),this._started=!0,this._config.transport.start().subscribe({onComplete:this._handleTransportComplete,onError:this._handleTransportError,onNext:this._handleTransportConnection,onSubscribe:e=>{this._subscription=e,e.request(Number.MAX_SAFE_INTEGER)}})}stop(){this._subscription&&this._subscription.cancel(),this._config.transport.stop(),this._handleTransportError(new Error("RSocketServer: Connection terminated via stop()."))}_getSerializers(){return this._config.serializers||Lo.IdentitySerializers}_setupLeaseError(e){const r=(e.flags&X.FLAGS.LEASE)===X.FLAGS.LEASE,n=this._config.leases;return r&&!n}}mt.default=Do;class ko{constructor(e){this._target=e}swap(e){return this._target=e,this._subscription&&this._target.onSubscribe&&this._target.onSubscribe(this._subscription),this}onComplete(){(0,De.default)(this._target,"must have target"),this._target.onComplete&&this._target.onComplete()}onError(e){(0,De.default)(this._target,"must have target"),this._target.onError&&this._target.onError(e)}onNext(e){(0,De.default)(this._target,"must have target"),this._target.onNext&&this._target.onNext(e)}onSubscribe(e){(0,De.default)(this._target,"must have target"),this._subscription=e,this._target.onSubscribe&&this._target.onSubscribe(e)}}function Go(t,e){return{data:t.data.deserialize(e.data),metadata:t.metadata.deserialize(e.metadata)}}var yt={},nr={},bt={};Object.defineProperty(bt,"__esModule",{value:!0}),bt.CONNECTION_STATUS=void 0;const Yo={CLOSED:Object.freeze({kind:"CLOSED"}),CONNECTED:Object.freeze({kind:"CONNECTED"}),CONNECTING:Object.freeze({kind:"CONNECTING"}),NOT_CONNECTED:Object.freeze({kind:"NOT_CONNECTED"})};bt.CONNECTION_STATUS=Yo;var qo=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module"}),Ho=Re(qo);(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=bt;Object.keys(e).forEach(function(n){n==="default"||n==="__esModule"||n in t&&t[n]===e[n]||Object.defineProperty(t,n,{enumerable:!0,get:function(){return e[n]}})});var r=Ho;Object.keys(r).forEach(function(n){n==="default"||n==="__esModule"||n in t&&t[n]===r[n]||Object.defineProperty(t,n,{enumerable:!0,get:function(){return r[n]}})})})(nr);var he={},oe={},z={};Object.defineProperty(z,"__esModule",{value:!0}),z.readUInt24BE=zo,z.writeUInt24BE=Vo,z.readUInt64BE=jo,z.writeUInt64BE=Xo,z.byteLength=$o,z.createBuffer=z.toBuffer=void 0;var ie=se;const ir=4294967296;function zo(t,e){const r=t.readUInt8(e)<<16,n=t.readUInt8(e+1)<<8,i=t.readUInt8(e+2);return r|n|i}function Vo(t,e,r){return r=t.writeUInt8(e>>>16,r),r=t.writeUInt8(e>>>8&255,r),t.writeUInt8(e&255,r)}function jo(t,e){const r=t.readUInt32BE(e),n=t.readUInt32BE(e+4);return r*ir+n}function Xo(t,e,r){const n=e/ir|0,i=e%ir;return r=t.writeUInt32BE(n,r),t.writeUInt32BE(i,r)}function $o(t,e){return t==null?0:ie.LiteBuffer.byteLength(t,e)}const Ko=typeof ie.LiteBuffer.from=="function"?(...t)=>t[0]instanceof ie.LiteBuffer?t[0]:ie.LiteBuffer.from.apply(ie.LiteBuffer,t):(...t)=>t[0]instanceof ie.LiteBuffer?t[0]:new(ie.LiteBuffer.bind.apply(ie.LiteBuffer,[ie.LiteBuffer,...t]));z.toBuffer=Ko;const Qo=typeof ie.LiteBuffer.alloc=="function"?t=>ie.LiteBuffer.alloc(t):t=>new ie.LiteBuffer(t).fill(0);z.createBuffer=Qo,Object.defineProperty(oe,"__esModule",{value:!0}),oe.BufferEncoders=oe.Utf8Encoders=oe.BufferEncoder=oe.UTF8Encoder=void 0;var Wo=z,sr=Jo(Oe);function Jo(t){return t&&t.__esModule?t:{default:t}}const ue={byteLength:t=>(0,Wo.byteLength)(t,"utf8"),decode:(t,e,r)=>t.toString("utf8",e,r),encode:(t,e,r,n)=>((0,sr.default)(typeof t=="string","RSocketEncoding: Expected value to be a string, got `%s`.",t),e.write(t,r,n-r,"utf8"),n)};oe.UTF8Encoder=ue;const At={byteLength:t=>((0,sr.default)(Buffer.isBuffer(t),"RSocketEncoding: Expected value to be a buffer, got `%s`.",t),t.length),decode:(t,e,r)=>t.slice(e,r),encode:(t,e,r,n)=>((0,sr.default)(Buffer.isBuffer(t),"RSocketEncoding: Expected value to be a buffer, got `%s`.",t),t.copy(e,r,0,t.length),n)};oe.BufferEncoder=At;const Zo={data:ue,dataMimeType:ue,message:ue,metadata:ue,metadataMimeType:ue,resumeToken:ue};oe.Utf8Encoders=Zo;const ea={data:At,dataMimeType:ue,message:ue,metadata:At,metadataMimeType:ue,resumeToken:At};oe.BufferEncoders=ea,Object.defineProperty(he,"__esModule",{value:!0}),he.deserializeFrameWithLength=ra,he.deserializeFrames=na,he.serializeFrameWithLength=ia,he.deserializeFrame=ar,he.serializeFrame=Wr,he.sizeOfFrame=sa;var F=ta(Oe),m=g,or=oe,N=z;function ta(t){return t&&t.__esModule?t:{default:t}}const O=6,pe=3;function ra(t,e){const r=(0,N.readUInt24BE)(t,0);return ar(t.slice(pe,pe+r),e)}function na(t,e){const r=[];let n=0;for(;n+pe<t.length;){const i=(0,N.readUInt24BE)(t,n),a=n+pe,c=a+i;if(c>t.length)break;const l=t.slice(a,c),d=ar(l,e);r.push(d),n=c}return[r,t.slice(n,t.length)]}function ia(t,e){const r=Wr(t,e),n=(0,N.createBuffer)(r.length+pe);return(0,N.writeUInt24BE)(n,r.length,0),r.copy(n,pe,0,r.length),n}function ar(t,e){e=e||or.Utf8Encoders;let r=0;const n=t.readInt32BE(r);r+=4,(0,F.default)(n>=0,"RSocketBinaryFraming: Invalid frame, expected a positive stream id, got `%s.",n);const i=t.readUInt16BE(r);r+=2;const a=i>>>m.FRAME_TYPE_OFFFSET,c=i&m.FLAGS_MASK;switch(a){case m.FRAME_TYPES.SETUP:return ua(t,n,c,e);case m.FRAME_TYPES.PAYLOAD:return Ba(t,n,c,e);case m.FRAME_TYPES.ERROR:return fa(t,n,c,e);case m.FRAME_TYPES.KEEPALIVE:return Ea(t,n,c,e);case m.FRAME_TYPES.REQUEST_FNF:return ga(t,n,c,e);case m.FRAME_TYPES.REQUEST_RESPONSE:return Ta(t,n,c,e);case m.FRAME_TYPES.REQUEST_STREAM:return Oa(t,n,c,e);case m.FRAME_TYPES.REQUEST_CHANNEL:return Pa(t,n,c,e);case m.FRAME_TYPES.METADATA_PUSH:return Ra(t,n,c,e);case m.FRAME_TYPES.REQUEST_N:return Na(t,n,c);case m.FRAME_TYPES.RESUME:return Ga(t,n,c,e);case m.FRAME_TYPES.RESUME_OK:return Ha(t,n,c);case m.FRAME_TYPES.CANCEL:return La(t,n,c);case m.FRAME_TYPES.LEASE:return Sa(t,n,c,e);default:(0,F.default)(!1,"RSocketBinaryFraming: Unsupported frame type `%s`.",(0,m.getFrameTypeName)(a))}}function Wr(t,e){switch(e=e||or.Utf8Encoders,t.type){case m.FRAME_TYPES.SETUP:return oa(t,e);case m.FRAME_TYPES.PAYLOAD:return Ua(t,e);case m.FRAME_TYPES.ERROR:return ca(t,e);case m.FRAME_TYPES.KEEPALIVE:return ha(t,e);case m.FRAME_TYPES.REQUEST_FNF:case m.FRAME_TYPES.REQUEST_RESPONSE:return ma(t,e);case m.FRAME_TYPES.REQUEST_STREAM:case m.FRAME_TYPES.REQUEST_CHANNEL:return Ia(t,e);case m.FRAME_TYPES.METADATA_PUSH:return ba(t,e);case m.FRAME_TYPES.REQUEST_N:return Ma(t);case m.FRAME_TYPES.RESUME:return Da(t,e);case m.FRAME_TYPES.RESUME_OK:return Ya(t);case m.FRAME_TYPES.CANCEL:return va(t);case m.FRAME_TYPES.LEASE:return _a(t,e);default:(0,F.default)(!1,"RSocketBinaryFraming: Unsupported frame type `%s`.",(0,m.getFrameTypeName)(t.type))}}function sa(t,e){switch(e=e||or.Utf8Encoders,t.type){case m.FRAME_TYPES.SETUP:return aa(t,e);case m.FRAME_TYPES.PAYLOAD:return xa(t,e);case m.FRAME_TYPES.ERROR:return la(t,e);case m.FRAME_TYPES.KEEPALIVE:return da(t,e);case m.FRAME_TYPES.REQUEST_FNF:case m.FRAME_TYPES.REQUEST_RESPONSE:return ya(t,e);case m.FRAME_TYPES.REQUEST_STREAM:case m.FRAME_TYPES.REQUEST_CHANNEL:return wa(t,e);case m.FRAME_TYPES.METADATA_PUSH:return Aa(t,e);case m.FRAME_TYPES.REQUEST_N:return Ca();case m.FRAME_TYPES.RESUME:return ka(t,e);case m.FRAME_TYPES.RESUME_OK:return qa();case m.FRAME_TYPES.CANCEL:return Fa();case m.FRAME_TYPES.LEASE:return pa(t,e);default:(0,F.default)(!1,"RSocketBinaryFraming: Unsupported frame type `%s`.",(0,m.getFrameTypeName)(t.type))}}const Jr=14,Zr=2;function oa(t,e){const r=t.resumeToken!=null?e.resumeToken.byteLength(t.resumeToken):0,n=t.metadataMimeType!=null?e.metadataMimeType.byteLength(t.metadataMimeType):0,i=t.dataMimeType!=null?e.dataMimeType.byteLength(t.dataMimeType):0,a=Se(t,e),c=(0,N.createBuffer)(O+Jr+(r?Zr+r:0)+n+i+a);let l=W(t,c);return l=c.writeUInt16BE(t.majorVersion,l),l=c.writeUInt16BE(t.minorVersion,l),l=c.writeUInt32BE(t.keepAlive,l),l=c.writeUInt32BE(t.lifetime,l),t.flags&m.FLAGS.RESUME_ENABLE&&(l=c.writeUInt16BE(r,l),t.resumeToken!=null&&(l=e.resumeToken.encode(t.resumeToken,c,l,l+r))),l=c.writeUInt8(n,l),t.metadataMimeType!=null&&(l=e.metadataMimeType.encode(t.metadataMimeType,c,l,l+n)),l=c.writeUInt8(i,l),t.dataMimeType!=null&&(l=e.dataMimeType.encode(t.dataMimeType,c,l,l+i)),gt(t,c,e,l),c}function aa(t,e){const r=t.resumeToken!=null?e.resumeToken.byteLength(t.resumeToken):0,n=t.metadataMimeType!=null?e.metadataMimeType.byteLength(t.metadataMimeType):0,i=t.dataMimeType!=null?e.dataMimeType.byteLength(t.dataMimeType):0,a=Se(t,e);return O+Jr+(r?Zr+r:0)+n+i+a}function ua(t,e,r,n){(0,F.default)(e===0,"RSocketBinaryFraming: Invalid SETUP frame, expected stream id to be 0.");const i=t.length;let a=O;const c=t.readUInt16BE(a);a+=2;const l=t.readUInt16BE(a);a+=2;const d=t.readInt32BE(a);a+=4,(0,F.default)(d>=0&&d<=m.MAX_KEEPALIVE,"RSocketBinaryFraming: Invalid SETUP frame, expected keepAlive to be >= 0 and <= %s. Got `%s`.",m.MAX_KEEPALIVE,d);const S=t.readInt32BE(a);a+=4,(0,F.default)(S>=0&&S<=m.MAX_LIFETIME,"RSocketBinaryFraming: Invalid SETUP frame, expected lifetime to be >= 0 and <= %s. Got `%s`.",m.MAX_LIFETIME,S);let y=null;if(r&m.FLAGS.RESUME_ENABLE){const Z=t.readInt16BE(a);a+=2,(0,F.default)(Z>=0&&Z<=m.MAX_RESUME_LENGTH,"RSocketBinaryFraming: Invalid SETUP frame, expected resumeToken length to be >= 0 and <= %s. Got `%s`.",m.MAX_RESUME_LENGTH,Z),y=n.resumeToken.decode(t,a,a+Z),a+=Z}const A=t.readUInt8(a);a+=1;const T=n.metadataMimeType.decode(t,a,a+A);a+=A;const R=t.readUInt8(a);a+=1;const w=n.dataMimeType.decode(t,a,a+R);a+=R;const M={data:null,dataMimeType:w,flags:r,keepAlive:d,length:i,lifetime:S,majorVersion:c,metadata:null,metadataMimeType:T,minorVersion:l,resumeToken:y,streamId:e,type:m.FRAME_TYPES.SETUP};return ke(t,M,n,a),M}const en=4;function ca(t,e){const r=t.message!=null?e.message.byteLength(t.message):0,n=(0,N.createBuffer)(O+en+r);let i=W(t,n);return i=n.writeUInt32BE(t.code,i),t.message!=null&&e.message.encode(t.message,n,i,i+r),n}function la(t,e){const r=t.message!=null?e.message.byteLength(t.message):0;return O+en+r}function fa(t,e,r,n){const i=t.length;let a=O;const c=t.readInt32BE(a);a+=4,(0,F.default)(c>=0&&c<=m.MAX_CODE,"RSocketBinaryFraming: Invalid ERROR frame, expected code to be >= 0 and <= %s. Got `%s`.",m.MAX_CODE,c);const l=t.length-a;let d="";return l>0&&(d=n.message.decode(t,a,a+l),a+=l),{code:c,flags:r,length:i,message:d,streamId:e,type:m.FRAME_TYPES.ERROR}}const tn=8;function ha(t,e){const r=t.data!=null?e.data.byteLength(t.data):0,n=(0,N.createBuffer)(O+tn+r);let i=W(t,n);return i=(0,N.writeUInt64BE)(n,t.lastReceivedPosition,i),t.data!=null&&e.data.encode(t.data,n,i,i+r),n}function da(t,e){const r=t.data!=null?e.data.byteLength(t.data):0;return O+tn+r}function Ea(t,e,r,n){(0,F.default)(e===0,"RSocketBinaryFraming: Invalid KEEPALIVE frame, expected stream id to be 0.");const i=t.length;let a=O;const c=(0,N.readUInt64BE)(t,a);a+=8;let l=null;return a<t.length&&(l=n.data.decode(t,a,t.length)),{data:l,flags:r,lastReceivedPosition:c,length:i,streamId:e,type:m.FRAME_TYPES.KEEPALIVE}}const rn=8;function _a(t,e){const r=t.metadata!=null?e.metadata.byteLength(t.metadata):0,n=(0,N.createBuffer)(O+rn+r);let i=W(t,n);return i=n.writeUInt32BE(t.ttl,i),i=n.writeUInt32BE(t.requestCount,i),t.metadata!=null&&e.metadata.encode(t.metadata,n,i,i+r),n}function pa(t,e){const r=t.metadata!=null?e.metadata.byteLength(t.metadata):0;return O+rn+r}function Sa(t,e,r,n){(0,F.default)(e===0,"RSocketBinaryFraming: Invalid LEASE frame, expected stream id to be 0.");const i=t.length;let a=O;const c=t.readUInt32BE(a);a+=4;const l=t.readUInt32BE(a);a+=4;let d=null;return a<t.length&&(d=n.metadata.decode(t,a,t.length)),{flags:r,length:i,metadata:d,requestCount:l,streamId:e,ttl:c,type:m.FRAME_TYPES.LEASE}}function ma(t,e){const r=Se(t,e),n=(0,N.createBuffer)(O+r),i=W(t,n);return gt(t,n,e,i),n}function ya(t,e){const r=Se(t,e);return O+r}function ba(t,e){const r=t.metadata;if(r!=null){const n=(0,N.createBuffer)(O+e.metadata.byteLength(r)),i=W(t,n);return e.metadata.encode(r,n,i,n.length),n}else{const n=(0,N.createBuffer)(O);return W(t,n),n}}function Aa(t,e){return O+(t.metadata!=null?e.metadata.byteLength(t.metadata):0)}function ga(t,e,r,n){(0,F.default)(e>0,"RSocketBinaryFraming: Invalid REQUEST_FNF frame, expected stream id to be > 0.");const i=t.length,a={data:null,flags:r,length:i,metadata:null,streamId:e,type:m.FRAME_TYPES.REQUEST_FNF};return ke(t,a,n,O),a}function Ta(t,e,r,n){(0,F.default)(e>0,"RSocketBinaryFraming: Invalid REQUEST_RESPONSE frame, expected stream id to be > 0.");const i=t.length,a={data:null,flags:r,length:i,metadata:null,streamId:e,type:m.FRAME_TYPES.REQUEST_RESPONSE};return ke(t,a,n,O),a}function Ra(t,e,r,n){(0,F.default)(e===0,"RSocketBinaryFraming: Invalid METADATA_PUSH frame, expected stream id to be 0.");const i=t.length;return{flags:r,length:i,metadata:i===O?null:n.metadata.decode(t,O,i),streamId:e,type:m.FRAME_TYPES.METADATA_PUSH}}const nn=4;function Ia(t,e){const r=Se(t,e),n=(0,N.createBuffer)(O+nn+r);let i=W(t,n);return i=n.writeUInt32BE(t.requestN,i),gt(t,n,e,i),n}function wa(t,e){const r=Se(t,e);return O+nn+r}function Oa(t,e,r,n){(0,F.default)(e>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected stream id to be > 0.");const i=t.length;let a=O;const c=t.readInt32BE(a);a+=4,(0,F.default)(c>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected requestN to be > 0, got `%s`.",c);const l={data:null,flags:r,length:i,metadata:null,requestN:c,streamId:e,type:m.FRAME_TYPES.REQUEST_STREAM};return ke(t,l,n,a),l}function Pa(t,e,r,n){(0,F.default)(e>0,"RSocketBinaryFraming: Invalid REQUEST_CHANNEL frame, expected stream id to be > 0.");const i=t.length;let a=O;const c=t.readInt32BE(a);a+=4,(0,F.default)(c>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected requestN to be > 0, got `%s`.",c);const l={data:null,flags:r,length:i,metadata:null,requestN:c,streamId:e,type:m.FRAME_TYPES.REQUEST_CHANNEL};return ke(t,l,n,a),l}const sn=4;function Ma(t,e){const r=(0,N.createBuffer)(O+sn),n=W(t,r);return r.writeUInt32BE(t.requestN,n),r}function Ca(t,e){return O+sn}function Na(t,e,r,n){(0,F.default)(e>0,"RSocketBinaryFraming: Invalid REQUEST_N frame, expected stream id to be > 0.");const i=t.length,a=t.readInt32BE(O);return(0,F.default)(a>0,"RSocketBinaryFraming: Invalid REQUEST_STREAM frame, expected requestN to be > 0, got `%s`.",a),{flags:r,length:i,requestN:a,streamId:e,type:m.FRAME_TYPES.REQUEST_N}}function va(t,e){const r=(0,N.createBuffer)(O);return W(t,r),r}function Fa(t,e){return O}function La(t,e,r,n){(0,F.default)(e>0,"RSocketBinaryFraming: Invalid CANCEL frame, expected stream id to be > 0.");const i=t.length;return{flags:r,length:i,streamId:e,type:m.FRAME_TYPES.CANCEL}}function Ua(t,e){const r=Se(t,e),n=(0,N.createBuffer)(O+r),i=W(t,n);return gt(t,n,e,i),n}function xa(t,e){const r=Se(t,e);return O+r}function Ba(t,e,r,n){(0,F.default)(e>0,"RSocketBinaryFraming: Invalid PAYLOAD frame, expected stream id to be > 0.");const i=t.length,a={data:null,flags:r,length:i,metadata:null,streamId:e,type:m.FRAME_TYPES.PAYLOAD};return ke(t,a,n,O),a}const on=22;function Da(t,e){const r=e.resumeToken.byteLength(t.resumeToken),n=(0,N.createBuffer)(O+on+r);let i=W(t,n);return i=n.writeUInt16BE(t.majorVersion,i),i=n.writeUInt16BE(t.minorVersion,i),i=n.writeUInt16BE(r,i),i=e.resumeToken.encode(t.resumeToken,n,i,i+r),i=(0,N.writeUInt64BE)(n,t.serverPosition,i),(0,N.writeUInt64BE)(n,t.clientPosition,i),n}function ka(t,e){const r=e.resumeToken.byteLength(t.resumeToken);return O+on+r}function Ga(t,e,r,n){(0,F.default)(e===0,"RSocketBinaryFraming: Invalid RESUME frame, expected stream id to be 0.");const i=t.length;let a=O;const c=t.readUInt16BE(a);a+=2;const l=t.readUInt16BE(a);a+=2;const d=t.readInt16BE(a);a+=2,(0,F.default)(d>=0&&d<=m.MAX_RESUME_LENGTH,"RSocketBinaryFraming: Invalid SETUP frame, expected resumeToken length to be >= 0 and <= %s. Got `%s`.",m.MAX_RESUME_LENGTH,d);const S=n.resumeToken.decode(t,a,a+d);a+=d;const y=(0,N.readUInt64BE)(t,a);a+=8;const A=(0,N.readUInt64BE)(t,a);return a+=8,{clientPosition:A,flags:r,length:i,majorVersion:c,minorVersion:l,resumeToken:S,serverPosition:y,streamId:e,type:m.FRAME_TYPES.RESUME}}const an=8;function Ya(t,e){const r=(0,N.createBuffer)(O+an),n=W(t,r);return(0,N.writeUInt64BE)(r,t.clientPosition,n),r}function qa(t,e){return O+an}function Ha(t,e,r,n){(0,F.default)(e===0,"RSocketBinaryFraming: Invalid RESUME frame, expected stream id to be 0.");const i=t.length;return{clientPosition:(0,N.readUInt64BE)(t,O),flags:r,length:i,streamId:e,type:m.FRAME_TYPES.RESUME_OK}}function W(t,e){const r=e.writeInt32BE(t.streamId,0);return e.writeUInt16BE(t.type<<m.FRAME_TYPE_OFFFSET|t.flags&m.FLAGS_MASK,r)}function Se(t,e){let r=0;return t.data!=null&&(r+=e.data.byteLength(t.data)),(0,m.isMetadata)(t.flags)&&(r+=pe,t.metadata!=null&&(r+=e.metadata.byteLength(t.metadata))),r}function gt(t,e,r,n){if((0,m.isMetadata)(t.flags))if(t.metadata!=null){const i=r.metadata.byteLength(t.metadata);n=(0,N.writeUInt24BE)(e,i,n),n=r.metadata.encode(t.metadata,e,n,n+i)}else n=(0,N.writeUInt24BE)(e,0,n);t.data!=null&&r.data.encode(t.data,e,n,e.length)}function ke(t,e,r,n){if((0,m.isMetadata)(e.flags)){const i=(0,N.readUInt24BE)(t,n);n+=pe,i>0&&(e.metadata=r.metadata.decode(t,n,n+i),n+=i)}n<t.length&&(e.data=r.data.decode(t,n,t.length))}Object.defineProperty(yt,"__esModule",{value:!0}),yt.default=void 0;var un=Ie,ur=Va(Oe),de=g,tt=nr,za=he;function Va(t){return t&&t.__esModule?t:{default:t}}function cn(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,n)}return r}function ln(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?cn(Object(r),!0).forEach(function(n){ja(t,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cn(Object(r)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))})}return t}function ja(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class Xa{constructor(e,r,n){(0,ur.default)(r.bufferSize>=0,"RSocketResumableTransport: bufferSize option must be >= 0, got `%s`.",r.bufferSize),this._encoders=n,this._bufferSize=r.bufferSize,this._sentFramesSize=0,this._position={client:0,server:0},this._currentConnection=null,this._statusSubscription=null,this._receiveSubscription=null,this._receivers=new Set,this._resumeToken=r.resumeToken,this._sessionTimeoutMillis=r.sessionDurationSeconds*1e3,this._sessionTimeoutHandle=null,this._senders=new Set,this._sentFrames=[],this._setupFrame=null,this._source=e,this._status=tt.CONNECTION_STATUS.NOT_CONNECTED,this._statusSubscribers=new Set}close(){this._close()}connect(){(0,ur.default)(!this._isTerminated(),"RSocketResumableTransport: Cannot connect(), connection terminated (%s: %s).",this._status.kind,this._status.kind==="ERROR"?this._status.error.message:"no message");try{this._disconnect(),this._currentConnection=null,this._receiveSubscription=null,this._statusSubscription=null,this._setConnectionStatus(tt.CONNECTION_STATUS.CONNECTING);const e=this._source();e.connectionStatus().subscribe({onNext:r=>{r.kind!==this._status.kind&&(r.kind==="CONNECTED"?(this._sessionTimeoutHandle&&(clearTimeout(this._sessionTimeoutHandle),this._sessionTimeoutHandle=null),this._setupFrame==null?this._handleConnected(e):this._handleResume(e)):this._isTerminationStatus(r)&&(this._sessionTimeoutHandle||(this._sessionTimeoutHandle=setTimeout(()=>this._close(this._resumeTimeoutError()),this._sessionTimeoutMillis)),this._disconnect(),this._setConnectionStatus(tt.CONNECTION_STATUS.NOT_CONNECTED)))},onSubscribe:r=>{this._statusSubscription=r,r.request(Number.MAX_SAFE_INTEGER)}}),e.connect()}catch(e){this._close(e)}}connectionStatus(){return new un.Flowable(e=>{e.onSubscribe({cancel:()=>{this._statusSubscribers.delete(e)},request:()=>{this._statusSubscribers.add(e),e.onNext(this._status)}})})}receive(){return new un.Flowable(e=>{let r=!1;e.onSubscribe({cancel:()=>{this._receivers.delete(e)},request:()=>{r||(r=!0,this._receivers.add(e))}})})}sendOne(e){try{this._writeFrame(e)}catch(r){this._close(r)}}send(e){let r;e.subscribe({onComplete:()=>{r&&this._senders.delete(r)},onError:n=>{r&&this._senders.delete(r),this._close(n)},onNext:n=>this._writeFrame(n),onSubscribe:n=>{r=n,this._senders.add(r),r.request(Number.MAX_SAFE_INTEGER)}})}_close(e){if(this._isTerminated())return;e?this._setConnectionStatus({error:e,kind:"ERROR"}):this._setConnectionStatus(tt.CONNECTION_STATUS.CLOSED);const r=this._receivers;r.forEach(i=>i.onComplete()),r.clear();const n=this._senders;n.forEach(i=>i.cancel()),n.clear(),this._sentFrames.length=0,this._disconnect()}_disconnect(){this._statusSubscription&&(this._statusSubscription.cancel(),this._statusSubscription=null),this._receiveSubscription&&(this._receiveSubscription.cancel(),this._receiveSubscription=null),this._currentConnection&&(this._currentConnection.close(),this._currentConnection=null)}_handleConnected(e){this._currentConnection=e,this._flushFrames(),this._setConnectionStatus(tt.CONNECTION_STATUS.CONNECTED),e.receive().subscribe({onNext:r=>{try{this._receiveFrame(r)}catch(n){this._close(n)}},onSubscribe:r=>{this._receiveSubscription=r,r.request(Number.MAX_SAFE_INTEGER)}})}_handleResume(e){e.receive().take(1).subscribe({onNext:n=>{try{if(n.type===de.FRAME_TYPES.RESUME_OK){const{clientPosition:i}=n;if(i<this._position.client){this._close(this._nonResumableStateError());return}let a=i-this._position.client,c=0;for(;a>0;){const l=this._onReleasedTailFrame(this._sentFrames[c]);if(!l){this._close(this._absentLengthError(n));return}a-=l,c++}if(a!==0){this._close(this._inconsistentImpliedPositionError());return}c>0&&this._sentFrames.splice(0,c),this._handleConnected(e)}else{const i=n.type===de.FRAME_TYPES.ERROR?(0,de.createErrorFromFrame)(n):new Error("RSocketResumableTransport: Resumption failed for an unspecified reason.");this._close(i)}}catch(i){this._close(i)}},onSubscribe:n=>{this._receiveSubscription=n,n.request(1)}});const r=this._setupFrame;(0,ur.default)(r,"RSocketResumableTransport: Cannot resume, setup frame has not been sent."),e.sendOne({clientPosition:this._position.client,flags:0,majorVersion:r.majorVersion,minorVersion:r.minorVersion,resumeToken:this._resumeToken,serverPosition:this._position.server,streamId:de.CONNECTION_STREAM_ID,type:de.FRAME_TYPES.RESUME})}_absentLengthError(e){return new Error("RSocketResumableTransport: absent frame.length for type "+e.type)}_inconsistentImpliedPositionError(){return new Error("RSocketResumableTransport: local frames are inconsistent with remote implied position")}_nonResumableStateError(){return new Error("RSocketResumableTransport: resumption failed, server is missing frames that are no longer in the client buffer.")}_resumeTimeoutError(){return new Error("RSocketResumableTransport: resumable session timed out")}_isTerminated(){return this._isTerminationStatus(this._status)}_isTerminationStatus(e){const r=e.kind;return r==="CLOSED"||r==="ERROR"}_setConnectionStatus(e){e.kind!==this._status.kind&&(this._status=e,this._statusSubscribers.forEach(r=>r.onNext(e)))}_receiveFrame(e){(0,de.isResumePositionFrameType)(e.type)&&e.length&&(this._position.server+=e.length),this._receivers.forEach(r=>r.onNext(e))}_flushFrames(){this._sentFrames.forEach(e=>{const r=this._currentConnection;r&&r.sendOne(e)})}_onReleasedTailFrame(e){const r=e.length;if(r)return this._sentFramesSize-=r,this._position.client+=r,r}_writeFrame(e){if(e.type===de.FRAME_TYPES.SETUP&&(e=ln(ln({},e),{},{flags:e.flags|de.FLAGS.RESUME_ENABLE,resumeToken:this._resumeToken}),this._setupFrame=e),e.length=(0,za.sizeOfFrame)(e,this._encoders),(0,de.isResumePositionFrameType)(e.type)){let n=this._bufferSize-this._sentFramesSize;const i=e.length;if(i){for(;n<i;){const a=this._sentFrames.shift();if(a){const c=this._onReleasedTailFrame(a);if(!c){this._close(this._absentLengthError(e));return}n+=c}else break}n>=i?(this._sentFrames.push(e),this._sentFramesSize+=i):this._position.client+=i}else{this._close(this._absentLengthError(e));return}}const r=this._currentConnection;r&&r.sendOne(e)}}yt.default=Xa;var p={};Object.defineProperty(p,"__esModule",{value:!0}),p.TYPES_BY_MIME_STRING=p.TYPES_BY_MIME_ID=p.MESSAGE_RSOCKET_COMPOSITE_METADATA=p.MESSAGE_RSOCKET_ROUTING=p.MESSAGE_RSOCKET_TRACING_ZIPKIN=p.MESSAGE_RSOCKET_AUTHENTICATION=p.MESSAGE_RSOCKET_ACCEPT_MIMETYPES=p.MESSAGE_RSOCKET_MIMETYPE=p.APPLICATION_CLOUDEVENTS_JSON=p.APPLICATION_JAVA_OBJECT=p.APPLICATION_HESSIAN=p.VIDEO_VP8=p.VIDEO_H265=p.VIDEO_H264=p.TEXT_XML=p.TEXT_PLAIN=p.TEXT_HTML=p.TEXT_CSV=p.TEXT_CSS=p.MULTIPART_MIXED=p.IMAGE_TIFF=p.IMAGE_PNG=p.IMAGE_JPEG=p.IMAGE_HEIF=p.IMAGE_HEIF_SEQUENCE=p.IMAGE_HEIC=p.IMAGE_HEIC_SEQUENCE=p.IMAGE_GIG=p.IMAGE_BMP=p.AUDIO_VORBIS=p.AUDIO_OPUS=p.AUDIO_OGG=p.AUDIO_MPEG=p.AUDIO_MPEG3=p.AUDIO_MP4=p.AUDIO_MP3=p.AUDIO_AAC=p.APPLICATION_ZIP=p.APPLICATION_XML=p.APPLICATION_PROTOBUF=p.APPLICATION_THRIFT=p.APPLICATION_PDF=p.APPLICATION_OCTET_STREAM=p.APPLICATION_JSON=p.APPLICATION_JAVASCRIPT=p.APPLICATION_GZIP=p.APPLICATION_GRAPHQL=p.APPLICATION_CBOR=p.APPLICATION_AVRO=p.UNKNOWN_RESERVED_MIME_TYPE=p.UNPARSEABLE_MIME_TYPE=p.default=void 0;class I{constructor(e,r){this._string=e,this._identifier=r}static fromIdentifier(e){return e<0||e>127?rt:nt[e]}static fromString(e){if(!e)throw new Error("type must be non-null");return e===Tt.string?rt:cr.get(e)||rt}get identifier(){return this._identifier}get string(){return this._string}toString(){return this._string}}p.default=I;const rt=new I("UNPARSEABLE_MIME_TYPE_DO_NOT_USE",-2);p.UNPARSEABLE_MIME_TYPE=rt;const Tt=new I("UNKNOWN_YET_RESERVED_DO_NOT_USE",-1);p.UNKNOWN_RESERVED_MIME_TYPE=Tt;const fn=new I("application/avro",0);p.APPLICATION_AVRO=fn;const hn=new I("application/cbor",1);p.APPLICATION_CBOR=hn;const dn=new I("application/graphql",2);p.APPLICATION_GRAPHQL=dn;const En=new I("application/gzip",3);p.APPLICATION_GZIP=En;const _n=new I("application/javascript",4);p.APPLICATION_JAVASCRIPT=_n;const pn=new I("application/json",5);p.APPLICATION_JSON=pn;const Sn=new I("application/octet-stream",6);p.APPLICATION_OCTET_STREAM=Sn;const mn=new I("application/pdf",7);p.APPLICATION_PDF=mn;const yn=new I("application/vnd.apache.thrift.binary",8);p.APPLICATION_THRIFT=yn;const bn=new I("application/vnd.google.protobuf",9);p.APPLICATION_PROTOBUF=bn;const An=new I("application/xml",10);p.APPLICATION_XML=An;const gn=new I("application/zip",11);p.APPLICATION_ZIP=gn;const Tn=new I("audio/aac",12);p.AUDIO_AAC=Tn;const Rn=new I("audio/mp3",13);p.AUDIO_MP3=Rn;const In=new I("audio/mp4",14);p.AUDIO_MP4=In;const wn=new I("audio/mpeg3",15);p.AUDIO_MPEG3=wn;const On=new I("audio/mpeg",16);p.AUDIO_MPEG=On;const Pn=new I("audio/ogg",17);p.AUDIO_OGG=Pn;const Mn=new I("audio/opus",18);p.AUDIO_OPUS=Mn;const Cn=new I("audio/vorbis",19);p.AUDIO_VORBIS=Cn;const Nn=new I("image/bmp",20);p.IMAGE_BMP=Nn;const vn=new I("image/gif",21);p.IMAGE_GIG=vn;const Fn=new I("image/heic-sequence",22);p.IMAGE_HEIC_SEQUENCE=Fn;const Ln=new I("image/heic",23);p.IMAGE_HEIC=Ln;const Un=new I("image/heif-sequence",24);p.IMAGE_HEIF_SEQUENCE=Un;const xn=new I("image/heif",25);p.IMAGE_HEIF=xn;const Bn=new I("image/jpeg",26);p.IMAGE_JPEG=Bn;const Dn=new I("image/png",27);p.IMAGE_PNG=Dn;const kn=new I("image/tiff",28);p.IMAGE_TIFF=kn;const Gn=new I("multipart/mixed",29);p.MULTIPART_MIXED=Gn;const Yn=new I("text/css",30);p.TEXT_CSS=Yn;const qn=new I("text/csv",31);p.TEXT_CSV=qn;const Hn=new I("text/html",32);p.TEXT_HTML=Hn;const zn=new I("text/plain",33);p.TEXT_PLAIN=zn;const Vn=new I("text/xml",34);p.TEXT_XML=Vn;const jn=new I("video/H264",35);p.VIDEO_H264=jn;const Xn=new I("video/H265",36);p.VIDEO_H265=Xn;const $n=new I("video/VP8",37);p.VIDEO_VP8=$n;const Kn=new I("application/x-hessian",38);p.APPLICATION_HESSIAN=Kn;const Qn=new I("application/x-java-object",39);p.APPLICATION_JAVA_OBJECT=Qn;const Wn=new I("application/cloudevents+json",40);p.APPLICATION_CLOUDEVENTS_JSON=Wn;const Jn=new I("message/x.rsocket.mime-type.v0",122);p.MESSAGE_RSOCKET_MIMETYPE=Jn;const Zn=new I("message/x.rsocket.accept-mime-types.v0",123);p.MESSAGE_RSOCKET_ACCEPT_MIMETYPES=Zn;const ei=new I("message/x.rsocket.authentication.v0",124);p.MESSAGE_RSOCKET_AUTHENTICATION=ei;const ti=new I("message/x.rsocket.tracing-zipkin.v0",125);p.MESSAGE_RSOCKET_TRACING_ZIPKIN=ti;const ri=new I("message/x.rsocket.routing.v0",126);p.MESSAGE_RSOCKET_ROUTING=ri;const ni=new I("message/x.rsocket.composite-metadata.v0",127);p.MESSAGE_RSOCKET_COMPOSITE_METADATA=ni;const nt=new Array(128);p.TYPES_BY_MIME_ID=nt;const cr=new Map;p.TYPES_BY_MIME_STRING=cr;const $a=[rt,Tt,fn,hn,dn,En,_n,pn,Sn,mn,yn,bn,An,gn,Tn,Rn,In,wn,On,Pn,Mn,Cn,Nn,vn,Fn,Ln,Un,xn,Bn,Dn,kn,Gn,Yn,qn,Hn,zn,Vn,jn,Xn,$n,Kn,Qn,Wn,Jn,Zn,ei,ti,ri,ni];nt.fill(Tt);for(const t of $a)t.identifier>=0&&(nt[t.identifier]=t,cr.set(t.string,t));Object.seal&&Object.seal(nt);var Y={};Object.defineProperty(Y,"__esModule",{value:!0}),Y.TYPES_BY_AUTH_STRING=Y.TYPES_BY_AUTH_ID=Y.BEARER=Y.SIMPLE=Y.UNKNOWN_RESERVED_AUTH_TYPE=Y.UNPARSEABLE_AUTH_TYPE=Y.default=void 0;class it{constructor(e,r){this._string=e,this._identifier=r}static fromIdentifier(e){return e<0||e>127?st:ot[e]}static fromString(e){if(!e)throw new Error("type must be non-null");return e===Rt.string?st:lr.get(e)||st}get identifier(){return this._identifier}get string(){return this._string}toString(){return this._string}}Y.default=it;const st=new it("UNPARSEABLE_AUTH_TYPE_DO_NOT_USE",-2);Y.UNPARSEABLE_AUTH_TYPE=st;const Rt=new it("UNKNOWN_YET_RESERVED_DO_NOT_USE",-1);Y.UNKNOWN_RESERVED_AUTH_TYPE=Rt;const ii=new it("simple",0);Y.SIMPLE=ii;const si=new it("bearer",1);Y.BEARER=si;const ot=new Array(128);Y.TYPES_BY_AUTH_ID=ot;const lr=new Map;Y.TYPES_BY_AUTH_STRING=lr;const Ka=[st,Rt,ii,si];ot.fill(Rt);for(const t of Ka)t.identifier>=0&&(ot[t.identifier]=t,lr.set(t.string,t));Object.seal&&Object.seal(ot);var k={};Object.defineProperty(k,"__esModule",{value:!0}),k.encodeCompositeMetadata=Ja,k.encodeAndAddCustomMetadata=ai,k.encodeAndAddWellKnownMetadata=ui,k.decodeMimeAndContentBuffersSlices=ci,k.decodeMimeTypeFromMimeBuffer=li,k.encodeCustomMetadataHeader=fi,k.encodeWellKnownMetadataHeader=hi,k.decodeCompositeMetadata=hr,k.WellKnownMimeTypeEntry=k.ReservedMimeTypeEntry=k.ExplicitMimeTimeEntry=k.CompositeMetadata=void 0;var fr=se,at=z,It=Qa(p);function oi(){if(typeof WeakMap!="function")return null;var t=new WeakMap;return oi=function(){return t},t}function Qa(t){if(t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var e=oi();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=n?Object.getOwnPropertyDescriptor(t,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}class Wa{constructor(e){this._buffer=e}iterator(){return hr(this._buffer)}[Symbol.iterator](){return hr(this._buffer)}}k.CompositeMetadata=Wa;function Ja(t){let e=(0,at.createBuffer)(0);for(const[r,n]of t){const i=typeof n=="function"?n():n;r instanceof It.default||typeof r=="number"||r.constructor.name==="WellKnownMimeType"?e=ui(e,r,i):e=ai(e,r,i)}return e}function ai(t,e,r){return fr.LiteBuffer.concat([t,fi(e,r.byteLength),r])}function ui(t,e,r){let n;return Number.isInteger(e)?n=e:n=e.identifier,fr.LiteBuffer.concat([t,hi(n,r.byteLength),r])}function ci(t,e){const r=t.readInt8(e);let n,i=e;if((r&dr)===dr)n=t.slice(i,i+1),i+=1;else{const a=(r&255)+1;if(t.byteLength>i+a)n=t.slice(i,i+a+1),i+=a+1;else throw new Error("Metadata is malformed. Inappropriately formed Mime Length")}if(t.byteLength>=i+3){const a=(0,at.readUInt24BE)(t,i);if(i+=3,t.byteLength>=a+i){const c=t.slice(i,i+a);return[n,c]}else throw new Error("Metadata is malformed. Inappropriately formed Metadata Length or malformed content")}else throw new Error("Metadata is malformed. Metadata Length is absent or malformed")}function li(t){if(t.length<2)throw new Error("Unable to decode explicit MIME type");return t.toString("ascii",1)}function fi(t,e){const r=(0,at.createBuffer)(4+t.length),n=r.write(t,1);if(!ru(r,1))throw new Error("Custom mime type must be US_ASCII characters only");if(n<1||n>128)throw new Error("Custom mime type must have a strictly positive length that fits on 7 unsigned bits, ie 1-128");return r.writeUInt8(n-1),(0,at.writeUInt24BE)(r,e,n+1),r}function hi(t,e){const r=fr.LiteBuffer.alloc(4);return r.writeUInt8(t|dr),(0,at.writeUInt24BE)(r,e,1),r}function*hr(t){const e=t.byteLength;let r=0;for(;r<e;){const n=ci(t,r),i=n[0],a=n[1];if(r=eu(r,i,a),!pi(i)){const d=li(i);if(!d)throw new Error("MIME type cannot be null");yield new di(a,d);continue}const c=Za(i),l=It.default.fromIdentifier(c);if(It.UNKNOWN_RESERVED_MIME_TYPE===l){yield new Ei(a,c);continue}yield new _i(a,l)}}class di{constructor(e,r){this._content=e,this._type=r}get content(){return this._content}get mimeType(){return this._type}}k.ExplicitMimeTimeEntry=di;class Ei{constructor(e,r){this._content=e,this._type=r}get content(){return this._content}get mimeType(){}get type(){return this._type}}k.ReservedMimeTypeEntry=Ei;class _i{constructor(e,r){this._content=e,this._type=r}get content(){return this._content}get mimeType(){return this._type.string}get type(){return this._type}}k.WellKnownMimeTypeEntry=_i;function Za(t){return pi(t)?t.readInt8()&tu:It.UNPARSEABLE_MIME_TYPE.identifier}function eu(t,e,r){return t+e.byteLength+3+r.byteLength}function pi(t){return t.byteLength===1}const dr=128,tu=127;function ru(t,e){let r=!0;for(let n=e,i=t.length;n<i;n++)if(t[n]>127){r=!1;break}return r}var Me={};Object.defineProperty(Me,"__esModule",{value:!0}),Me.encodeRoutes=iu,Me.encodeRoute=yi,Me.decodeRoutes=Er,Me.RoutingMetadata=void 0;var Si=se,mi=z;class nu{constructor(e){this._buffer=e}iterator(){return Er(this._buffer)}[Symbol.iterator](){return Er(this._buffer)}}Me.RoutingMetadata=nu;function iu(...t){if(t.length<1)throw new Error("routes should be non empty array");return Si.LiteBuffer.concat(t.map(e=>yi(e)))}function yi(t){const e=(0,mi.toBuffer)(t,"utf8");if(e.length>255)throw new Error(`route length should fit into unsigned byte length but the given one is ${e.length}`);const r=(0,mi.createBuffer)(1);return r.writeUInt8(e.length),Si.LiteBuffer.concat([r,e])}function*Er(t){const e=t.byteLength;let r=0;for(;r<e;){const n=t.readUInt8(r++);if(r+n>e)throw new Error(`Malformed RouteMetadata. Offset(${r}) + RouteLength(${n}) is greater than TotalLength`);const i=t.toString("utf8",r,r+n);r+=n,yield i}}var me={};Object.defineProperty(me,"__esModule",{value:!0}),me.encodeWellKnownAuthMetadata=au,me.encodeCustomAuthMetadata=uu,me.encodeSimpleAuthMetadata=cu,me.encodeBearerAuthMetadata=lu,me.decodeAuthMetadata=fu,me.decodeSimpleAuthPayload=hu;var wt=se,ye=z,Ge=su(Y);function bi(){if(typeof WeakMap!="function")return null;var t=new WeakMap;return bi=function(){return t},t}function su(t){if(t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var e=bi();if(e&&e.has(t))return e.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=n?Object.getOwnPropertyDescriptor(t,i):null;a&&(a.get||a.set)?Object.defineProperty(r,i,a):r[i]=t[i]}return r.default=t,e&&e.set(t,r),r}const _r=1,Ye=1,qe=2,pr=128,ou=127;function au(t,e){if(t===Ge.UNPARSEABLE_AUTH_TYPE||t===Ge.UNKNOWN_RESERVED_AUTH_TYPE)throw new Error(`Illegal WellKnownAuthType[${t.toString()}]. Only allowed AuthType should be used`);const r=(0,ye.createBuffer)(_r);return r.writeUInt8(t.identifier|pr),wt.LiteBuffer.concat([r,e])}function uu(t,e){const r=(0,ye.toBuffer)(t);if(r.byteLength!==t.length)throw new Error("Custom auth type must be US_ASCII characters only");if(r.byteLength<1||r.byteLength>128)throw new Error("Custom auth type must have a strictly positive length that fits on 7 unsigned bits, ie 1-128");const n=(0,ye.createBuffer)(Ye+r.byteLength);return n.writeUInt8(r.byteLength-1),n.write(t,Ye),wt.LiteBuffer.concat([n,e])}function cu(t,e){const r=(0,ye.toBuffer)(t),n=(0,ye.toBuffer)(e),i=r.byteLength;if(i>65535)throw new Error(`Username should be shorter than or equal to 65535 bytes length in UTF-8 encoding but the given was ${i}`);const a=_r+qe,c=(0,ye.createBuffer)(a);return c.writeUInt8(Ge.SIMPLE.identifier|pr),c.writeUInt16BE(i,1),wt.LiteBuffer.concat([c,r,n])}function lu(t){const e=(0,ye.toBuffer)(t),r=(0,ye.createBuffer)(_r);return r.writeUInt8(Ge.BEARER.identifier|pr),wt.LiteBuffer.concat([r,e])}function fu(t){if(t.byteLength<1)throw new Error("Unable to decode Auth metadata. Not enough readable bytes");const e=t.readUInt8(),r=e&ou;if(r!==e){const n=Ge.default.fromIdentifier(r);return{payload:t.slice(1),type:{identifier:n.identifier,string:n.string}}}else{const n=e+1;if(t.byteLength<n+Ye)throw new Error("Unable to decode custom Auth type. Malformed length or auth type string");const i=t.toString("utf8",Ye,Ye+n);return{payload:t.slice(n+Ye),type:{identifier:Ge.UNPARSEABLE_AUTH_TYPE.identifier,string:i}}}}function hu(t){if(t.byteLength<qe)throw new Error("Unable to decode Simple Auth Payload. Not enough readable bytes");const e=t.readUInt16BE();if(t.byteLength<e+qe)throw new Error("Unable to decode Simple Auth Payload. Not enough readable bytes");const r=t.slice(qe,qe+e);return{password:t.slice(qe+e),username:r}}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RSocketClient",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(t,"RSocketServer",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(t,"RSocketResumableTransport",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"WellKnownMimeType",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(t,"UNPARSEABLE_MIME_TYPE",{enumerable:!0,get:function(){return i.UNPARSEABLE_MIME_TYPE}}),Object.defineProperty(t,"UNKNOWN_RESERVED_MIME_TYPE",{enumerable:!0,get:function(){return i.UNKNOWN_RESERVED_MIME_TYPE}}),Object.defineProperty(t,"APPLICATION_AVRO",{enumerable:!0,get:function(){return i.APPLICATION_AVRO}}),Object.defineProperty(t,"APPLICATION_CBOR",{enumerable:!0,get:function(){return i.APPLICATION_CBOR}}),Object.defineProperty(t,"APPLICATION_GRAPHQL",{enumerable:!0,get:function(){return i.APPLICATION_GRAPHQL}}),Object.defineProperty(t,"APPLICATION_GZIP",{enumerable:!0,get:function(){return i.APPLICATION_GZIP}}),Object.defineProperty(t,"APPLICATION_JAVASCRIPT",{enumerable:!0,get:function(){return i.APPLICATION_JAVASCRIPT}}),Object.defineProperty(t,"APPLICATION_JSON",{enumerable:!0,get:function(){return i.APPLICATION_JSON}}),Object.defineProperty(t,"APPLICATION_OCTET_STREAM",{enumerable:!0,get:function(){return i.APPLICATION_OCTET_STREAM}}),Object.defineProperty(t,"APPLICATION_PDF",{enumerable:!0,get:function(){return i.APPLICATION_PDF}}),Object.defineProperty(t,"APPLICATION_THRIFT",{enumerable:!0,get:function(){return i.APPLICATION_THRIFT}}),Object.defineProperty(t,"APPLICATION_PROTOBUF",{enumerable:!0,get:function(){return i.APPLICATION_PROTOBUF}}),Object.defineProperty(t,"APPLICATION_XML",{enumerable:!0,get:function(){return i.APPLICATION_XML}}),Object.defineProperty(t,"APPLICATION_ZIP",{enumerable:!0,get:function(){return i.APPLICATION_ZIP}}),Object.defineProperty(t,"AUDIO_AAC",{enumerable:!0,get:function(){return i.AUDIO_AAC}}),Object.defineProperty(t,"AUDIO_MP3",{enumerable:!0,get:function(){return i.AUDIO_MP3}}),Object.defineProperty(t,"AUDIO_MP4",{enumerable:!0,get:function(){return i.AUDIO_MP4}}),Object.defineProperty(t,"AUDIO_MPEG3",{enumerable:!0,get:function(){return i.AUDIO_MPEG3}}),Object.defineProperty(t,"AUDIO_MPEG",{enumerable:!0,get:function(){return i.AUDIO_MPEG}}),Object.defineProperty(t,"AUDIO_OGG",{enumerable:!0,get:function(){return i.AUDIO_OGG}}),Object.defineProperty(t,"AUDIO_OPUS",{enumerable:!0,get:function(){return i.AUDIO_OPUS}}),Object.defineProperty(t,"AUDIO_VORBIS",{enumerable:!0,get:function(){return i.AUDIO_VORBIS}}),Object.defineProperty(t,"IMAGE_BMP",{enumerable:!0,get:function(){return i.IMAGE_BMP}}),Object.defineProperty(t,"IMAGE_GIG",{enumerable:!0,get:function(){return i.IMAGE_GIG}}),Object.defineProperty(t,"IMAGE_HEIC_SEQUENCE",{enumerable:!0,get:function(){return i.IMAGE_HEIC_SEQUENCE}}),Object.defineProperty(t,"IMAGE_HEIC",{enumerable:!0,get:function(){return i.IMAGE_HEIC}}),Object.defineProperty(t,"IMAGE_HEIF_SEQUENCE",{enumerable:!0,get:function(){return i.IMAGE_HEIF_SEQUENCE}}),Object.defineProperty(t,"IMAGE_HEIF",{enumerable:!0,get:function(){return i.IMAGE_HEIF}}),Object.defineProperty(t,"IMAGE_JPEG",{enumerable:!0,get:function(){return i.IMAGE_JPEG}}),Object.defineProperty(t,"IMAGE_PNG",{enumerable:!0,get:function(){return i.IMAGE_PNG}}),Object.defineProperty(t,"IMAGE_TIFF",{enumerable:!0,get:function(){return i.IMAGE_TIFF}}),Object.defineProperty(t,"MULTIPART_MIXED",{enumerable:!0,get:function(){return i.MULTIPART_MIXED}}),Object.defineProperty(t,"TEXT_CSS",{enumerable:!0,get:function(){return i.TEXT_CSS}}),Object.defineProperty(t,"TEXT_CSV",{enumerable:!0,get:function(){return i.TEXT_CSV}}),Object.defineProperty(t,"TEXT_HTML",{enumerable:!0,get:function(){return i.TEXT_HTML}}),Object.defineProperty(t,"TEXT_PLAIN",{enumerable:!0,get:function(){return i.TEXT_PLAIN}}),Object.defineProperty(t,"TEXT_XML",{enumerable:!0,get:function(){return i.TEXT_XML}}),Object.defineProperty(t,"VIDEO_H264",{enumerable:!0,get:function(){return i.VIDEO_H264}}),Object.defineProperty(t,"VIDEO_H265",{enumerable:!0,get:function(){return i.VIDEO_H265}}),Object.defineProperty(t,"VIDEO_VP8",{enumerable:!0,get:function(){return i.VIDEO_VP8}}),Object.defineProperty(t,"APPLICATION_HESSIAN",{enumerable:!0,get:function(){return i.APPLICATION_HESSIAN}}),Object.defineProperty(t,"APPLICATION_JAVA_OBJECT",{enumerable:!0,get:function(){return i.APPLICATION_JAVA_OBJECT}}),Object.defineProperty(t,"APPLICATION_CLOUDEVENTS_JSON",{enumerable:!0,get:function(){return i.APPLICATION_CLOUDEVENTS_JSON}}),Object.defineProperty(t,"MESSAGE_RSOCKET_MIMETYPE",{enumerable:!0,get:function(){return i.MESSAGE_RSOCKET_MIMETYPE}}),Object.defineProperty(t,"MESSAGE_RSOCKET_ACCEPT_MIMETYPES",{enumerable:!0,get:function(){return i.MESSAGE_RSOCKET_ACCEPT_MIMETYPES}}),Object.defineProperty(t,"MESSAGE_RSOCKET_AUTHENTICATION",{enumerable:!0,get:function(){return i.MESSAGE_RSOCKET_AUTHENTICATION}}),Object.defineProperty(t,"MESSAGE_RSOCKET_TRACING_ZIPKIN",{enumerable:!0,get:function(){return i.MESSAGE_RSOCKET_TRACING_ZIPKIN}}),Object.defineProperty(t,"MESSAGE_RSOCKET_ROUTING",{enumerable:!0,get:function(){return i.MESSAGE_RSOCKET_ROUTING}}),Object.defineProperty(t,"MESSAGE_RSOCKET_COMPOSITE_METADATA",{enumerable:!0,get:function(){return i.MESSAGE_RSOCKET_COMPOSITE_METADATA}}),Object.defineProperty(t,"WellKnownAuthType",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(t,"UNPARSEABLE_AUTH_TYPE",{enumerable:!0,get:function(){return a.UNPARSEABLE_AUTH_TYPE}}),Object.defineProperty(t,"UNKNOWN_RESERVED_AUTH_TYPE",{enumerable:!0,get:function(){return a.UNKNOWN_RESERVED_AUTH_TYPE}}),Object.defineProperty(t,"SIMPLE",{enumerable:!0,get:function(){return a.SIMPLE}}),Object.defineProperty(t,"BEARER",{enumerable:!0,get:function(){return a.BEARER}}),Object.defineProperty(t,"CONNECTION_STREAM_ID",{enumerable:!0,get:function(){return c.CONNECTION_STREAM_ID}}),Object.defineProperty(t,"ERROR_CODES",{enumerable:!0,get:function(){return c.ERROR_CODES}}),Object.defineProperty(t,"ERROR_EXPLANATIONS",{enumerable:!0,get:function(){return c.ERROR_EXPLANATIONS}}),Object.defineProperty(t,"FLAGS_MASK",{enumerable:!0,get:function(){return c.FLAGS_MASK}}),Object.defineProperty(t,"FLAGS",{enumerable:!0,get:function(){return c.FLAGS}}),Object.defineProperty(t,"FRAME_TYPE_OFFFSET",{enumerable:!0,get:function(){return c.FRAME_TYPE_OFFFSET}}),Object.defineProperty(t,"FRAME_TYPES",{enumerable:!0,get:function(){return c.FRAME_TYPES}}),Object.defineProperty(t,"MAX_CODE",{enumerable:!0,get:function(){return c.MAX_CODE}}),Object.defineProperty(t,"MAX_KEEPALIVE",{enumerable:!0,get:function(){return c.MAX_KEEPALIVE}}),Object.defineProperty(t,"MAX_LIFETIME",{enumerable:!0,get:function(){return c.MAX_LIFETIME}}),Object.defineProperty(t,"MAX_MIME_LENGTH",{enumerable:!0,get:function(){return c.MAX_MIME_LENGTH}}),Object.defineProperty(t,"MAX_RESUME_LENGTH",{enumerable:!0,get:function(){return c.MAX_RESUME_LENGTH}}),Object.defineProperty(t,"MAX_STREAM_ID",{enumerable:!0,get:function(){return c.MAX_STREAM_ID}}),Object.defineProperty(t,"MAX_VERSION",{enumerable:!0,get:function(){return c.MAX_VERSION}}),Object.defineProperty(t,"createErrorFromFrame",{enumerable:!0,get:function(){return c.createErrorFromFrame}}),Object.defineProperty(t,"getErrorCodeExplanation",{enumerable:!0,get:function(){return c.getErrorCodeExplanation}}),Object.defineProperty(t,"isComplete",{enumerable:!0,get:function(){return c.isComplete}}),Object.defineProperty(t,"isIgnore",{enumerable:!0,get:function(){return c.isIgnore}}),Object.defineProperty(t,"isLease",{enumerable:!0,get:function(){return c.isLease}}),Object.defineProperty(t,"isMetadata",{enumerable:!0,get:function(){return c.isMetadata}}),Object.defineProperty(t,"isNext",{enumerable:!0,get:function(){return c.isNext}}),Object.defineProperty(t,"isRespond",{enumerable:!0,get:function(){return c.isRespond}}),Object.defineProperty(t,"isResumeEnable",{enumerable:!0,get:function(){return c.isResumeEnable}}),Object.defineProperty(t,"printFrame",{enumerable:!0,get:function(){return c.printFrame}}),Object.defineProperty(t,"deserializeFrame",{enumerable:!0,get:function(){return l.deserializeFrame}}),Object.defineProperty(t,"deserializeFrameWithLength",{enumerable:!0,get:function(){return l.deserializeFrameWithLength}}),Object.defineProperty(t,"deserializeFrames",{enumerable:!0,get:function(){return l.deserializeFrames}}),Object.defineProperty(t,"serializeFrame",{enumerable:!0,get:function(){return l.serializeFrame}}),Object.defineProperty(t,"serializeFrameWithLength",{enumerable:!0,get:function(){return l.serializeFrameWithLength}}),Object.defineProperty(t,"byteLength",{enumerable:!0,get:function(){return d.byteLength}}),Object.defineProperty(t,"createBuffer",{enumerable:!0,get:function(){return d.createBuffer}}),Object.defineProperty(t,"readUInt24BE",{enumerable:!0,get:function(){return d.readUInt24BE}}),Object.defineProperty(t,"toBuffer",{enumerable:!0,get:function(){return d.toBuffer}}),Object.defineProperty(t,"writeUInt24BE",{enumerable:!0,get:function(){return d.writeUInt24BE}}),Object.defineProperty(t,"BufferEncoders",{enumerable:!0,get:function(){return S.BufferEncoders}}),Object.defineProperty(t,"BufferEncoder",{enumerable:!0,get:function(){return S.BufferEncoder}}),Object.defineProperty(t,"Utf8Encoders",{enumerable:!0,get:function(){return S.Utf8Encoders}}),Object.defineProperty(t,"UTF8Encoder",{enumerable:!0,get:function(){return S.UTF8Encoder}}),Object.defineProperty(t,"IdentitySerializer",{enumerable:!0,get:function(){return y.IdentitySerializer}}),Object.defineProperty(t,"IdentitySerializers",{enumerable:!0,get:function(){return y.IdentitySerializers}}),Object.defineProperty(t,"JsonSerializer",{enumerable:!0,get:function(){return y.JsonSerializer}}),Object.defineProperty(t,"JsonSerializers",{enumerable:!0,get:function(){return y.JsonSerializers}}),Object.defineProperty(t,"Leases",{enumerable:!0,get:function(){return A.Leases}}),Object.defineProperty(t,"Lease",{enumerable:!0,get:function(){return A.Lease}}),Object.defineProperty(t,"CompositeMetadata",{enumerable:!0,get:function(){return T.CompositeMetadata}}),Object.defineProperty(t,"ReservedMimeTypeEntry",{enumerable:!0,get:function(){return T.ReservedMimeTypeEntry}}),Object.defineProperty(t,"WellKnownMimeTypeEntry",{enumerable:!0,get:function(){return T.WellKnownMimeTypeEntry}}),Object.defineProperty(t,"ExplicitMimeTimeEntry",{enumerable:!0,get:function(){return T.ExplicitMimeTimeEntry}}),Object.defineProperty(t,"encodeAndAddCustomMetadata",{enumerable:!0,get:function(){return T.encodeAndAddCustomMetadata}}),Object.defineProperty(t,"encodeAndAddWellKnownMetadata",{enumerable:!0,get:function(){return T.encodeAndAddWellKnownMetadata}}),Object.defineProperty(t,"encodeCompositeMetadata",{enumerable:!0,get:function(){return T.encodeCompositeMetadata}}),Object.defineProperty(t,"decodeCompositeMetadata",{enumerable:!0,get:function(){return T.decodeCompositeMetadata}}),Object.defineProperty(t,"RoutingMetadata",{enumerable:!0,get:function(){return R.RoutingMetadata}}),Object.defineProperty(t,"encodeRoute",{enumerable:!0,get:function(){return R.encodeRoute}}),Object.defineProperty(t,"encodeRoutes",{enumerable:!0,get:function(){return R.encodeRoutes}}),Object.defineProperty(t,"decodeRoutes",{enumerable:!0,get:function(){return R.decodeRoutes}}),Object.defineProperty(t,"encodeSimpleAuthMetadata",{enumerable:!0,get:function(){return w.encodeSimpleAuthMetadata}}),Object.defineProperty(t,"encodeBearerAuthMetadata",{enumerable:!0,get:function(){return w.encodeBearerAuthMetadata}}),Object.defineProperty(t,"encodeWellKnownAuthMetadata",{enumerable:!0,get:function(){return w.encodeWellKnownAuthMetadata}}),Object.defineProperty(t,"encodeCustomAuthMetadata",{enumerable:!0,get:function(){return w.encodeCustomAuthMetadata}}),Object.defineProperty(t,"decodeSimpleAuthPayload",{enumerable:!0,get:function(){return w.decodeSimpleAuthPayload}}),Object.defineProperty(t,"decodeAuthMetadata",{enumerable:!0,get:function(){return w.decodeAuthMetadata}});var e=ce(ht),r=ce(mt),n=ce(yt),i=Z(p),a=Z(Y),c=g,l=he,d=z,S=oe,y=K,A=ne,T=k,R=Me,w=me;function M(){if(typeof WeakMap!="function")return null;var C=new WeakMap;return M=function(){return C},C}function Z(C){if(C&&C.__esModule)return C;if(C===null||typeof C!="object"&&typeof C!="function")return{default:C};var le=M();if(le&&le.has(C))return le.get(C);var ve={},_e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ge in C)if(Object.prototype.hasOwnProperty.call(C,ge)){var Fe=_e?Object.getOwnPropertyDescriptor(C,ge):null;Fe&&(Fe.get||Fe.set)?Object.defineProperty(ve,ge,Fe):ve[ge]=C[ge]}return ve.default=C,le&&le.set(C,ve),ve}function ce(C){return C&&C.__esModule?C:{default:C}}})(ee);var Sr={},Ot={};Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.default=void 0;var Ai=Ie,ut=ee,Pt=nr;function Mt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class du{constructor(e,r){Mt(this,"_handleClosed",n=>{this._close(new Error(n.reason||"RSocketWebSocketClient: Socket closed unexpectedly."))}),Mt(this,"_handleError",n=>{this._close(n.error)}),Mt(this,"_handleOpened",()=>{this._setConnectionStatus(Pt.CONNECTION_STATUS.CONNECTED)}),Mt(this,"_handleMessage",n=>{try{const i=this._readFrame(n);this._receivers.forEach(a=>a.onNext(i))}catch(i){this._close(i)}}),this._encoders=r,this._options=e,this._receivers=new Set,this._senders=new Set,this._socket=null,this._status=Pt.CONNECTION_STATUS.NOT_CONNECTED,this._statusSubscribers=new Set}close(){this._close()}connect(){if(this._status.kind!=="NOT_CONNECTED")throw new Error("RSocketWebSocketClient: Cannot connect(), a connection is already established.");this._setConnectionStatus(Pt.CONNECTION_STATUS.CONNECTING);const e=this._options.wsCreator,r=this._options.url;this._socket=e?e(r):new WebSocket(r);const n=this._socket;n.binaryType="arraybuffer",n.addEventListener("close",this._handleClosed),n.addEventListener("error",this._handleError),n.addEventListener("open",this._handleOpened),n.addEventListener("message",this._handleMessage)}connectionStatus(){return new Ai.Flowable(e=>{e.onSubscribe({cancel:()=>{this._statusSubscribers.delete(e)},request:()=>{this._statusSubscribers.add(e),e.onNext(this._status)}})})}receive(){return new Ai.Flowable(e=>{e.onSubscribe({cancel:()=>{this._receivers.delete(e)},request:()=>{this._receivers.add(e)}})})}sendOne(e){this._writeFrame(e)}send(e){let r;e.subscribe({onComplete:()=>{r&&this._senders.delete(r)},onError:n=>{r&&this._senders.delete(r),this._close(n)},onNext:n=>this._writeFrame(n),onSubscribe:n=>{r=n,this._senders.add(r),r.request(Number.MAX_SAFE_INTEGER)}})}_close(e){if(this._status.kind==="CLOSED"||this._status.kind==="ERROR")return;const r=e?{error:e,kind:"ERROR"}:Pt.CONNECTION_STATUS.CLOSED;this._setConnectionStatus(r),this._receivers.forEach(i=>{e?i.onError(e):i.onComplete()}),this._receivers.clear(),this._senders.forEach(i=>i.cancel()),this._senders.clear();const n=this._socket;n&&(n.removeEventListener("close",this._handleClosed),n.removeEventListener("error",this._handleError),n.removeEventListener("open",this._handleOpened),n.removeEventListener("message",this._handleMessage),n.close(),this._socket=null)}_setConnectionStatus(e){this._status=e,this._statusSubscribers.forEach(r=>r.onNext(e))}_readFrame(e){const r=(0,ut.toBuffer)(e.data);return this._options.lengthPrefixedFrames?(0,ut.deserializeFrameWithLength)(r,this._encoders):(0,ut.deserializeFrame)(r,this._encoders)}_writeFrame(e){try{const r=this._options.lengthPrefixedFrames?(0,ut.serializeFrameWithLength)(e,this._encoders):(0,ut.serializeFrame)(e,this._encoders);if(!this._socket)throw new Error("RSocketWebSocketClient: Cannot send frame, not connected.");this._socket.send(r)}catch(r){this._close(r)}}}Ot.default=du,Object.defineProperty(Sr,"__esModule",{value:!0});var gi=Sr.default=void 0,Eu=_u(Ot);function _u(t){return t&&t.__esModule?t:{default:t}}var pu=Eu.default;gi=Sr.default=pu;var mr;(function(t){t.Browser="browser",t.Android="android",t.IOS="ios",t.API="api"})(mr||(mr={}));class Ct{constructor(e,r="",n="",i=mr.Browser,a=6e4,c=18e4){L(this,"funConnect",null);L(this,"clientType","");L(this,"token","");L(this,"clientId","");L(this,"keepAlive");L(this,"lifetime");L(this,"url","ws://localhost");L(this,"_listener",null);this.keepAlive=a,this.lifetime=c,this.clientId=r,this.token=n,this.url=e,this.clientType=i}connectionConfig(e){return this}resumeListener(e){return this._listener=e,this}}L(Ct,"dataMimeType",ee.APPLICATION_JSON.string),L(Ct,"metadataMimeType",ee.MESSAGE_RSOCKET_COMPOSITE_METADATA.string);/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var yr=function(t,e){return yr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(r[i]=n[i])},yr(t,e)};function be(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");yr(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}function Su(t,e,r,n){function i(a){return a instanceof r?a:new r(function(c){c(a)})}return new(r||(r=Promise))(function(a,c){function l(y){try{S(n.next(y))}catch(A){c(A)}}function d(y){try{S(n.throw(y))}catch(A){c(A)}}function S(y){y.done?a(y.value):i(y.value).then(l,d)}S((n=n.apply(t,e||[])).next())})}function Ti(t,e){var r={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,c;return c={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(c[Symbol.iterator]=function(){return this}),c;function l(S){return function(y){return d([S,y])}}function d(S){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=S[0]&2?i.return:S[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,S[1])).done)return a;switch(i=0,a&&(S=[S[0]&2,a.value]),S[0]){case 0:case 1:a=S;break;case 4:return r.label++,{value:S[1],done:!1};case 5:r.label++,i=S[1],S=[0];continue;case 7:S=r.ops.pop(),r.trys.pop();continue;default:if(a=r.trys,!(a=a.length>0&&a[a.length-1])&&(S[0]===6||S[0]===2)){r=0;continue}if(S[0]===3&&(!a||S[1]>a[0]&&S[1]<a[3])){r.label=S[1];break}if(S[0]===6&&r.label<a[1]){r.label=a[1],a=S;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(S);break}a[2]&&r.ops.pop(),r.trys.pop();continue}S=e.call(t,r)}catch(y){S=[6,y],i=0}finally{n=a=0}if(S[0]&5)throw S[1];return{value:S[0]?S[1]:void 0,done:!0}}}function He(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Nt(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var n=r.call(t),i,a=[],c;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(l){c={error:l}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(c)throw c.error}}return a}function vt(t,e,r){if(r||arguments.length===2)for(var n=0,i=e.length,a;n<i;n++)(a||!(n in e))&&(a||(a=Array.prototype.slice.call(e,0,n)),a[n]=e[n]);return t.concat(a||Array.prototype.slice.call(e))}function ze(t){return this instanceof ze?(this.v=t,this):new ze(t)}function mu(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=r.apply(t,e||[]),i,a=[];return i={},c("next"),c("throw"),c("return"),i[Symbol.asyncIterator]=function(){return this},i;function c(T){n[T]&&(i[T]=function(R){return new Promise(function(w,M){a.push([T,R,w,M])>1||l(T,R)})})}function l(T,R){try{d(n[T](R))}catch(w){A(a[0][3],w)}}function d(T){T.value instanceof ze?Promise.resolve(T.value.v).then(S,y):A(a[0][2],T)}function S(T){l("next",T)}function y(T){l("throw",T)}function A(T,R){T(R),a.shift(),a.length&&l(a[0][0],a[0][1])}}function yu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof He=="function"?He(t):t[Symbol.iterator](),r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r);function n(a){r[a]=t[a]&&function(c){return new Promise(function(l,d){c=t[a](c),i(l,d,c.done,c.value)})}}function i(a,c,l,d){Promise.resolve(d).then(function(S){a({value:S,done:l})},c)}}function q(t){return typeof t=="function"}function Ft(t){var e=function(n){Error.call(n),n.stack=new Error().stack},r=t(e);return r.prototype=Object.create(Error.prototype),r.prototype.constructor=r,r}var br=Ft(function(t){return function(r){t(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r}});function Lt(t,e){if(t){var r=t.indexOf(e);0<=r&&t.splice(r,1)}}var ct=function(){function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}return t.prototype.unsubscribe=function(){var e,r,n,i,a;if(!this.closed){this.closed=!0;var c=this._parentage;if(c)if(this._parentage=null,Array.isArray(c))try{for(var l=He(c),d=l.next();!d.done;d=l.next()){var S=d.value;S.remove(this)}}catch(M){e={error:M}}finally{try{d&&!d.done&&(r=l.return)&&r.call(l)}finally{if(e)throw e.error}}else c.remove(this);var y=this.initialTeardown;if(q(y))try{y()}catch(M){a=M instanceof br?M.errors:[M]}var A=this._teardowns;if(A){this._teardowns=null;try{for(var T=He(A),R=T.next();!R.done;R=T.next()){var w=R.value;try{wi(w)}catch(M){a=a!=null?a:[],M instanceof br?a=vt(vt([],Nt(a)),Nt(M.errors)):a.push(M)}}}catch(M){n={error:M}}finally{try{R&&!R.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}}if(a)throw new br(a)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)wi(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=(r=this._teardowns)!==null&&r!==void 0?r:[]).push(e)}},t.prototype._hasParent=function(e){var r=this._parentage;return r===e||Array.isArray(r)&&r.includes(e)},t.prototype._addParent=function(e){var r=this._parentage;this._parentage=Array.isArray(r)?(r.push(e),r):r?[r,e]:e},t.prototype._removeParent=function(e){var r=this._parentage;r===e?this._parentage=null:Array.isArray(r)&&Lt(r,e)},t.prototype.remove=function(e){var r=this._teardowns;r&&Lt(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=function(){var e=new t;return e.closed=!0,e}(),t}(),Ri=ct.EMPTY;function Ii(t){return t instanceof ct||t&&"closed"in t&&q(t.remove)&&q(t.add)&&q(t.unsubscribe)}function wi(t){q(t)?t():t.unsubscribe()}var lt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Ut={setTimeout:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Ut.delegate;return((r==null?void 0:r.setTimeout)||setTimeout).apply(void 0,vt([],Nt(t)))},clearTimeout:function(t){var e=Ut.delegate;return((e==null?void 0:e.clearTimeout)||clearTimeout)(t)},delegate:void 0};function Oi(t){Ut.setTimeout(function(){var e=lt.onUnhandledError;if(e)e(t);else throw t})}function Pi(){}var bu=function(){return Ar("C",void 0,void 0)}();function Au(t){return Ar("E",void 0,t)}function gu(t){return Ar("N",t,void 0)}function Ar(t,e,r){return{kind:t,value:e,error:r}}var xt=null;function Bt(t){if(lt.useDeprecatedSynchronousErrorHandling){var e=!xt;if(e&&(xt={errorThrown:!1,error:null}),t(),e){var r=xt,n=r.errorThrown,i=r.error;if(xt=null,n)throw i}}else t()}var gr=function(t){be(e,t);function e(r){var n=t.call(this)||this;return n.isStopped=!1,r?(n.destination=r,Ii(r)&&r.add(n)):n.destination=wu,n}return e.create=function(r,n,i){return new Rr(r,n,i)},e.prototype.next=function(r){this.isStopped?Ir(gu(r),this):this._next(r)},e.prototype.error=function(r){this.isStopped?Ir(Au(r),this):(this.isStopped=!0,this._error(r))},e.prototype.complete=function(){this.isStopped?Ir(bu,this):(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this),this.destination=null)},e.prototype._next=function(r){this.destination.next(r)},e.prototype._error=function(r){try{this.destination.error(r)}finally{this.unsubscribe()}},e.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},e}(ct),Tu=Function.prototype.bind;function Tr(t,e){return Tu.call(t,e)}var Ru=function(){function t(e){this.partialObserver=e}return t.prototype.next=function(e){var r=this.partialObserver;if(r.next)try{r.next(e)}catch(n){Dt(n)}},t.prototype.error=function(e){var r=this.partialObserver;if(r.error)try{r.error(e)}catch(n){Dt(n)}else Dt(e)},t.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(r){Dt(r)}},t}(),Rr=function(t){be(e,t);function e(r,n,i){var a=t.call(this)||this,c;if(q(r)||!r)c={next:r!=null?r:void 0,error:n!=null?n:void 0,complete:i!=null?i:void 0};else{var l;a&&lt.useDeprecatedNextContext?(l=Object.create(r),l.unsubscribe=function(){return a.unsubscribe()},c={next:r.next&&Tr(r.next,l),error:r.error&&Tr(r.error,l),complete:r.complete&&Tr(r.complete,l)}):c=r}return a.destination=new Ru(c),a}return e}(gr);function Dt(t){Oi(t)}function Iu(t){throw t}function Ir(t,e){var r=lt.onStoppedNotification;r&&Ut.setTimeout(function(){return r(t,e)})}var wu={closed:!0,next:Pi,error:Iu,complete:Pi},wr=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Mi(t){return t}function Ou(t){return t.length===0?Mi:t.length===1?t[0]:function(r){return t.reduce(function(n,i){return i(n)},r)}}var J=function(){function t(e){e&&(this._subscribe=e)}return t.prototype.lift=function(e){var r=new t;return r.source=this,r.operator=e,r},t.prototype.subscribe=function(e,r,n){var i=this,a=Mu(e)?e:new Rr(e,r,n);return Bt(function(){var c=i,l=c.operator,d=c.source;a.add(l?l.call(a,d):d?i._subscribe(a):i._trySubscribe(a))}),a},t.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(r){e.error(r)}},t.prototype.forEach=function(e,r){var n=this;return r=Ci(r),new r(function(i,a){var c=new Rr({next:function(l){try{e(l)}catch(d){a(d),c.unsubscribe()}},error:a,complete:i});n.subscribe(c)})},t.prototype._subscribe=function(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)},t.prototype[wr]=function(){return this},t.prototype.pipe=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Ou(e)(this)},t.prototype.toPromise=function(e){var r=this;return e=Ci(e),new e(function(n,i){var a;r.subscribe(function(c){return a=c},function(c){return i(c)},function(){return n(a)})})},t.create=function(e){return new t(e)},t}();function Ci(t){var e;return(e=t!=null?t:lt.Promise)!==null&&e!==void 0?e:Promise}function Pu(t){return t&&q(t.next)&&q(t.error)&&q(t.complete)}function Mu(t){return t&&t instanceof gr||Pu(t)&&Ii(t)}function Cu(t){return q(t==null?void 0:t.lift)}function Ce(t){return function(e){if(Cu(e))return e.lift(function(r){try{return t(r,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function Ne(t,e,r,n,i){return new Nu(t,e,r,n,i)}var Nu=function(t){be(e,t);function e(r,n,i,a,c,l){var d=t.call(this,r)||this;return d.onFinalize=c,d.shouldUnsubscribe=l,d._next=n?function(S){try{n(S)}catch(y){r.error(y)}}:t.prototype._next,d._error=a?function(S){try{a(S)}catch(y){r.error(y)}finally{this.unsubscribe()}}:t.prototype._error,d._complete=i?function(){try{i()}catch(S){r.error(S)}finally{this.unsubscribe()}}:t.prototype._complete,d}return e.prototype.unsubscribe=function(){var r;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;t.prototype.unsubscribe.call(this),!n&&((r=this.onFinalize)===null||r===void 0||r.call(this))}},e}(gr),vu=Ft(function(t){return function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}}),Ni=function(t){be(e,t);function e(){var r=t.call(this)||this;return r.closed=!1,r.observers=[],r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return e.prototype.lift=function(r){var n=new vi(this,this);return n.operator=r,n},e.prototype._throwIfClosed=function(){if(this.closed)throw new vu},e.prototype.next=function(r){var n=this;Bt(function(){var i,a;if(n._throwIfClosed(),!n.isStopped){var c=n.observers.slice();try{for(var l=He(c),d=l.next();!d.done;d=l.next()){var S=d.value;S.next(r)}}catch(y){i={error:y}}finally{try{d&&!d.done&&(a=l.return)&&a.call(l)}finally{if(i)throw i.error}}}})},e.prototype.error=function(r){var n=this;Bt(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=r;for(var i=n.observers;i.length;)i.shift().error(r)}})},e.prototype.complete=function(){var r=this;Bt(function(){if(r._throwIfClosed(),!r.isStopped){r.isStopped=!0;for(var n=r.observers;n.length;)n.shift().complete()}})},e.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=null},Object.defineProperty(e.prototype,"observed",{get:function(){var r;return((r=this.observers)===null||r===void 0?void 0:r.length)>0},enumerable:!1,configurable:!0}),e.prototype._trySubscribe=function(r){return this._throwIfClosed(),t.prototype._trySubscribe.call(this,r)},e.prototype._subscribe=function(r){return this._throwIfClosed(),this._checkFinalizedStatuses(r),this._innerSubscribe(r)},e.prototype._innerSubscribe=function(r){var n=this,i=n.hasError,a=n.isStopped,c=n.observers;return i||a?Ri:(c.push(r),new ct(function(){return Lt(c,r)}))},e.prototype._checkFinalizedStatuses=function(r){var n=this,i=n.hasError,a=n.thrownError,c=n.isStopped;i?r.error(a):c&&r.complete()},e.prototype.asObservable=function(){var r=new J;return r.source=this,r},e.create=function(r,n){return new vi(r,n)},e}(J),vi=function(t){be(e,t);function e(r,n){var i=t.call(this)||this;return i.destination=r,i.source=n,i}return e.prototype.next=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,r)},e.prototype.error=function(r){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,r)},e.prototype.complete=function(){var r,n;(n=(r=this.destination)===null||r===void 0?void 0:r.complete)===null||n===void 0||n.call(r)},e.prototype._subscribe=function(r){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(r))!==null&&i!==void 0?i:Ri},e}(Ni),Fi={now:function(){return(Fi.delegate||Date).now()},delegate:void 0},Fu=function(t){be(e,t);function e(r,n){return t.call(this)||this}return e.prototype.schedule=function(r,n){return this},e}(ct),kt={setInterval:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=kt.delegate;return((r==null?void 0:r.setInterval)||setInterval).apply(void 0,vt([],Nt(t)))},clearInterval:function(t){var e=kt.delegate;return((e==null?void 0:e.clearInterval)||clearInterval)(t)},delegate:void 0},Lu=function(t){be(e,t);function e(r,n){var i=t.call(this,r,n)||this;return i.scheduler=r,i.work=n,i.pending=!1,i}return e.prototype.schedule=function(r,n){if(n===void 0&&(n=0),this.closed)return this;this.state=r;var i=this.id,a=this.scheduler;return i!=null&&(this.id=this.recycleAsyncId(a,i,n)),this.pending=!0,this.delay=n,this.id=this.id||this.requestAsyncId(a,this.id,n),this},e.prototype.requestAsyncId=function(r,n,i){return i===void 0&&(i=0),kt.setInterval(r.flush.bind(r,this),i)},e.prototype.recycleAsyncId=function(r,n,i){if(i===void 0&&(i=0),i!=null&&this.delay===i&&this.pending===!1)return n;kt.clearInterval(n)},e.prototype.execute=function(r,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(r,n);if(i)return i;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(r,n){var i=!1,a;try{this.work(r)}catch(c){i=!0,a=c||new Error("Scheduled action threw falsy error")}if(i)return this.unsubscribe(),a},e.prototype.unsubscribe=function(){if(!this.closed){var r=this,n=r.id,i=r.scheduler,a=i.actions;this.work=this.state=this.scheduler=null,this.pending=!1,Lt(a,this),n!=null&&(this.id=this.recycleAsyncId(i,n,null)),this.delay=null,t.prototype.unsubscribe.call(this)}},e}(Fu),Li=function(){function t(e,r){r===void 0&&(r=t.now),this.schedulerActionCtor=e,this.now=r}return t.prototype.schedule=function(e,r,n){return r===void 0&&(r=0),new this.schedulerActionCtor(this,e).schedule(n,r)},t.now=Fi.now,t}(),Uu=function(t){be(e,t);function e(r,n){n===void 0&&(n=Li.now);var i=t.call(this,r,n)||this;return i.actions=[],i._active=!1,i._scheduled=void 0,i}return e.prototype.flush=function(r){var n=this.actions;if(this._active){n.push(r);return}var i;this._active=!0;do if(i=r.execute(r.state,r.delay))break;while(r=n.shift());if(this._active=!1,i){for(;r=n.shift();)r.unsubscribe();throw i}},e}(Li),xu=new Uu(Lu),Bu=new J(function(t){return t.complete()}),Du=function(t){return t&&typeof t.length=="number"&&typeof t!="function"};function ku(t){return q(t==null?void 0:t.then)}function Gu(t){return q(t[wr])}function Yu(t){return Symbol.asyncIterator&&q(t==null?void 0:t[Symbol.asyncIterator])}function qu(t){return new TypeError("You provided "+(t!==null&&typeof t=="object"?"an invalid object":"'"+t+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Hu(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var zu=Hu();function Vu(t){return q(t==null?void 0:t[zu])}function ju(t){return mu(this,arguments,function(){var r,n,i,a;return Ti(this,function(c){switch(c.label){case 0:r=t.getReader(),c.label=1;case 1:c.trys.push([1,,9,10]),c.label=2;case 2:return[4,ze(r.read())];case 3:return n=c.sent(),i=n.value,a=n.done,a?[4,ze(void 0)]:[3,5];case 4:return[2,c.sent()];case 5:return[4,ze(i)];case 6:return[4,c.sent()];case 7:return c.sent(),[3,2];case 8:return[3,10];case 9:return r.releaseLock(),[7];case 10:return[2]}})})}function Xu(t){return q(t==null?void 0:t.getReader)}function Ui(t){if(t instanceof J)return t;if(t!=null){if(Gu(t))return $u(t);if(Du(t))return Ku(t);if(ku(t))return Qu(t);if(Yu(t))return xi(t);if(Vu(t))return Wu(t);if(Xu(t))return Ju(t)}throw qu(t)}function $u(t){return new J(function(e){var r=t[wr]();if(q(r.subscribe))return r.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Ku(t){return new J(function(e){for(var r=0;r<t.length&&!e.closed;r++)e.next(t[r]);e.complete()})}function Qu(t){return new J(function(e){t.then(function(r){e.closed||(e.next(r),e.complete())},function(r){return e.error(r)}).then(null,Oi)})}function Wu(t){return new J(function(e){var r,n;try{for(var i=He(t),a=i.next();!a.done;a=i.next()){var c=a.value;if(e.next(c),e.closed)return}}catch(l){r={error:l}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}e.complete()})}function xi(t){return new J(function(e){Zu(t,e).catch(function(r){return e.error(r)})})}function Ju(t){return xi(ju(t))}function Zu(t,e){var r,n,i,a;return Su(this,void 0,void 0,function(){var c,l;return Ti(this,function(d){switch(d.label){case 0:d.trys.push([0,5,6,11]),r=yu(t),d.label=1;case 1:return[4,r.next()];case 2:if(n=d.sent(),!!n.done)return[3,4];if(c=n.value,e.next(c),e.closed)return[2];d.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return l=d.sent(),i={error:l},[3,11];case 6:return d.trys.push([6,,9,10]),n&&!n.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:d.sent(),d.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return e.complete(),[2]}})})}function ec(t,e,r,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var a=e.schedule(function(){r(),i?t.add(this.schedule(null,n)):this.unsubscribe()},n);if(t.add(a),!i)return a}function Bi(t,e){var r=q(t)?t:function(){return t},n=function(i){return i.error(r())};return new J(e?function(i){return e.schedule(n,0,i)}:n)}var Di=Ft(function(t){return function(){t(this),this.name="EmptyError",this.message="no elements in sequence"}});function tc(t){return t instanceof Date&&!isNaN(t)}var rc=Ft(function(t){return function(r){r===void 0&&(r=null),t(this),this.message="Timeout has occurred",this.name="TimeoutError",this.info=r}});function ki(t,e){var r=tc(t)?{first:t}:typeof t=="number"?{each:t}:t,n=r.first,i=r.each,a=r.with,c=a===void 0?nc:a,l=r.scheduler,d=l===void 0?e!=null?e:xu:l,S=r.meta,y=S===void 0?null:S;if(n==null&&i==null)throw new TypeError("No timeout provided.");return Ce(function(A,T){var R,w,M=null,Z=0,ce=function(C){w=ec(T,d,function(){try{R.unsubscribe(),Ui(c({meta:y,lastValue:M,seen:Z})).subscribe(T)}catch(le){T.error(le)}},C)};R=A.subscribe(Ne(T,function(C){w==null||w.unsubscribe(),Z++,T.next(M=C),i>0&&ce(i)},void 0,void 0,function(){(w==null?void 0:w.closed)||w==null||w.unsubscribe(),M=null})),ce(n!=null?typeof n=="number"?n:+n-d.now():i)})}function nc(t){throw new rc(t)}function Ee(t,e){return Ce(function(r,n){var i=0;r.subscribe(Ne(n,function(a){n.next(t.call(e,a,i++))}))})}function ic(t,e){return Ce(function(r,n){var i=0;r.subscribe(Ne(n,function(a){return t.call(e,a,i++)&&n.next(a)}))})}function Or(t){return Ce(function(e,r){var n=null,i=!1,a;n=e.subscribe(Ne(r,void 0,void 0,function(c){a=Ui(t(c,Or(t)(e))),n?(n.unsubscribe(),n=null,a.subscribe(r)):i=!0})),i&&(n.unsubscribe(),n=null,a.subscribe(r))})}function sc(t){return Ce(function(e,r){var n=!1;e.subscribe(Ne(r,function(i){n=!0,r.next(i)},function(){n||r.next(t),r.complete()}))})}function oc(t){return t<=0?function(){return Bu}:Ce(function(e,r){var n=0;e.subscribe(Ne(r,function(i){++n<=t&&(r.next(i),t<=n&&r.complete())}))})}function ac(t){return t===void 0&&(t=uc),Ce(function(e,r){var n=!1;e.subscribe(Ne(r,function(i){n=!0,r.next(i)},function(){return n?r.complete():r.error(t())}))})}function uc(){return new Di}function Ve(t,e){var r=arguments.length>=2;return function(n){return n.pipe(t?ic(function(i,a){return t(i,a,n)}):Mi,oc(1),r?sc(e):ac(function(){return new Di}))}}class Ae{constructor(e,r={fireAndForget(n){console.log(n.data)}}){L(this,"config");L(this,"_rsocket");L(this,"isManualClose",!1);L(this,"connectionStatus",new Ni);L(this,"clientFactory",()=>new ee.RSocketClient({setup:{dataMimeType:Ct.dataMimeType,keepAlive:this.config.keepAlive,lifetime:this.config.lifetime,metadataMimeType:Ct.metadataMimeType,payload:{data:this.setupData()}},transport:new ee.RSocketResumableTransport(()=>new gi({debug:!0,url:this.config.url,wsCreator:e=>new WebSocket(e)},ee.BufferEncoders),{bufferSize:10,resumeToken:Buffer.from(this.config.clientId),sessionDurationSeconds:180},ee.BufferEncoders),responder:this.responder}));L(this,"responder");this.config=e,this.responder=r}get rsocket(){return new J(e=>{if(this._rsocket)e.next(this._rsocket);else{const r=setInterval(()=>{this._rsocket&&(e.next(this._rsocket),clearInterval(r))},100)}})}connect(){this.isManualClose=!1,this.config.clientId.length>0?this._connect():this.config.funConnect=this._connect.bind(this)}_connect(){this.clientFactory().connect().subscribe({onComplete:e=>{this._rsocket=e,this._rsocket.connectionStatus().subscribe({onError:r=>{console.error(r)},onNext:r=>{this.connectionStatus.next(r),!this.isManualClose&&(r.kind=="ERROR"||r.kind=="CLOSED")},onSubscribe:r=>r.request(2147483647)})},onError:e=>{console.error(e)}})}close(){this.isManualClose=!0,this.rsocket.pipe(Ve()).subscribe(e=>e.close())}broadcast(e,r,n={}){return n.header=n.header||new Map,n.header.set("method","broadcast"),this.rsocket.pipe(Ve(),Ee(i=>i.requestChannel(Ie.Flowable.just(this.getRequestPayload(e,r,n.header)))),Yi,Ee(i=>Ae.getResponsePayload(i)))}get(e,r,n={}){return n.header=n.header||new Map,n.header.set("method","get"),this.rsocket.pipe(Ve(),Ee(i=>i.requestResponse(this.getRequestPayload(e,r,n.header))),Gi,ki(n.timeout||6e3),Or(i=>Bi(()=>i.name=="TimeoutError"?{code:-1,space:"global"}:i)),Ee(i=>Ae.getResponsePayload(i)))}post(e,r,n={}){return n.header=n.header||new Map,n.header.set("method","post"),this.rsocket.pipe(Ve(),Ee(i=>i.requestResponse(this.getRequestPayload(e,r,n.header))),Gi,ki(n.timeout||6e3),Or(i=>Bi(()=>i.name=="TimeoutError"?{code:-1,space:"global"}:i)),Ee(i=>null))}fire(e,r,n=new Map){n.set("method","fire"),this.rsocket.pipe(Ve(),Ee(i=>i.fireAndForget(this.getRequestPayload(e,r,n))))}stream(e,r,n={}){return n.header=n.header||new Map,n.header.set("method","stream"),this.rsocket.pipe(Ve(),Ee(i=>i.requestStream(this.getRequestPayload(e,r,n.header))),Yi,Ee(i=>Ae.getResponsePayload(i)))}static getResponsePayload(e){let r;if(e.data)try{r=JSON.parse(e.data.toString())}catch{r=e.data.toString()}else r={};return r}getRequestPayload(e,r,n=new Map){const i=[ee.MESSAGE_RSOCKET_ROUTING,ee.encodeRoute(e)];n.get("sessionId")||n.set("sessionId",this.config.clientId);let a={};for(const d of n.keys())a[d]=n.get(d);const c=[ee.APPLICATION_JSON,Buffer.from(JSON.stringify(a))];let l;return r?l=Buffer.from(typeof r=="object"?JSON.stringify(r):r):l=void 0,{data:l,metadata:ee.encodeCompositeMetadata([i,c])}}setupData(){return Buffer.from(JSON.stringify({token:this.config.token==""?void 0:this.config.token,clientId:this.config.clientId,clientType:this.config.clientType}))}}function Gi(t){return new J(e=>{t.subscribe(r=>{r.subscribe({onError(n){try{const i=JSON.parse(n.source.message);console.error(i.errMsg),e.error({code:i.errCode,space:i.errSpace})}catch{console.error(n),e.error({code:0,space:"global"})}},onComplete(n){e.next(n),e.complete()},onSubscribe(n){let i=e.unsubscribe;e.unsubscribe=()=>{i.call(e)}}})})})}function Yi(t){return new J(e=>{t.subscribe(r=>{r.subscribe({onNext(n){e.next(n)},onError(n){try{const i=JSON.parse(n.source.message);console.error(i.errMsg),e.error({code:i.errCode,space:i.errSpace})}catch{console.error(n),e.error({code:0,space:"global"})}},onComplete(){e.complete()},onSubscribe(n){let i=e.unsubscribe;e.unsubscribe=()=>{n.cancel(),i.call(e)},n.request(2147483647)}})})})}class cc{constructor(e){L(this,"asgardClientConfig");L(this,"asgardClient");this.asgardClientConfig=e,this.asgardClient=new Ae(this.asgardClientConfig)}connect(){this.asgardClient.connect()}loadingGameList(){return this.asgardClient.get("/home/loading/gameList")}loadingLevel(){return this.asgardClient.get("/home/loading/level")}loadingRouletteCounter(){return this.asgardClient.get("/home/loading/rouletteCounter")}rouletteCollect(){return this.asgardClient.get("/home/roulette/collect")}loadingFreeRoulette(){return this.asgardClient.get("/home/loading/freeRoulette")}loadingPiggyBank(){return this.asgardClient.get("/home/loading/piggyBank")}rouletteFreePrizeLuckyDraw(){return this.asgardClient.get("/home/roulette/freePrizeLuckyDraw")}loadingPayRoulette(){return this.asgardClient.get("/home/loading/payRoulette")}tempSetBalance(e){return this.asgardClient.get("/home/temp/setBalance",e)}loadingUserInfo(){return this.asgardClient.get("/home/loading/userInfo")}loadingUserBalance(){return this.asgardClient.get("/home/loading/userBalance")}loadingOftenPlayGame(){return this.asgardClient.get("/home/loading/oftenPlayGame")}timeSynchronous(){return this.asgardClient.get("/home/time/synchronous")}loadingTreasureChest(){return this.asgardClient.get("/home/loading/treasureChest")}treasureChestAcceptOrPass(e){return this.asgardClient.post("/home/treasureChest/acceptOrPass",e)}treasureChestCountdown(e){return this.asgardClient.post("/home/treasureChest/countdown",e)}treasureChestSpeedUp(e){return this.asgardClient.get("/home/treasureChest/speedUp",e)}treasureChestOpen(e){return this.asgardClient.get("/home/treasureChest/open",e)}}class lc{constructor(e){L(this,"asgardClientConfig");L(this,"asgardClient");this.asgardClientConfig=e,this.asgardClient=new Ae(this.asgardClientConfig)}connect(){this.asgardClient.connect()}boardIncome(e){return this.asgardClient.broadcast(`/mail/income/${e.userId}`)}getMail(){return this.asgardClient.get("/mail/mail")}}class fc{constructor(e){L(this,"asgardClientConfig");L(this,"asgardClient");this.asgardClientConfig=e,this.asgardClient=new Ae(this.asgardClientConfig)}connect(){this.asgardClient.connect()}getSeasonTaskDetail(){return this.asgardClient.get("/season/task/detail")}submitSeasonTask(e){return this.asgardClient.get("/season/task/submit",e)}getSeasonTaskReward(e){return this.asgardClient.get("/season/task/draw",e)}}class hc{constructor(e){L(this,"asgardClientConfig");L(this,"asgardClient");this.asgardClientConfig=e,this.asgardClient=new Ae(this.asgardClientConfig)}connect(){this.asgardClient.connect()}loginDeviceNumber(e){return this.asgardClient.get("/user/login/deviceNumber",e)}getAchievements(){return this.asgardClient.get("/user/achievement")}getGetReward(e){return this.asgardClient.get("/user/achievement/getReward",e)}}H.EvelynnServiceHome=cc,H.EvelynnServiceMail=lc,H.EvelynnServiceSeason=fc,H.EvelynnServiceUser=hc,Object.defineProperty(H,"__esModule",{value:!0}),H[Symbol.toStringTag]="Module"});
